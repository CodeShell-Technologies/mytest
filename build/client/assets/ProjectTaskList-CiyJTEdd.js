import{w as Ae}from"./with-props-DF0D9zIo.js";import{r as a,j as e,b as Pe}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as Fe}from"./DataTable-DtyPIAGZ.js";import{C as Le}from"./CustomPagination-CBTcVvJz.js";import{S as ze}from"./SearchInput-CMdOUuSO.js";import{M as $}from"./Modal-BCIUwH-b.js";import{D as j}from"./DrapDown-CEm3nLdF.js";import{F as Oe,u as B,w as Ie}from"./xlsx-DTxMWUdD.js";import{t as Ve,B as J,a as K}from"./api-C04JdqFc.js";import{O as qe,V as b}from"./index-DxoBGdjx.js";import{u as M}from"./AuthStore-BnYeBJES.js";import{u as Re}from"./useBranchStore-kvv3vD_e.js";import{u as Ue}from"./use-click-outside-BhLpsQYS.js";import"./ProjectStore-Bmk5yusB.js";import"./LeadsStore-C-d0npQs.js";import"./useEmployeeStore-BJ_SZO4g.js";import{A as He}from"./AddNewTask-Dl9c1PYs.js";import{E as Qe}from"./EditTaskForm-Cwdu_Gp4.js";import{N as Ge}from"./network-4iL8t-Of.js";import{C as Je}from"./clipboard-type-fPi_05HQ.js";import{T as Ke}from"./tag-hjf6KM-t.js";import{E as We}from"./eye-2Mk8PZw-.js";import{S as Xe}from"./square-pen-hueQTsQ_.js";import{T as Ye}from"./trash-2-AUNIB88j.js";import"./index-knF4tUPh.js";/* empty css            */import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";/* empty css                         */import"./moment-C5S46NFB.js";import"./ButtonLoader-Z62NVHwI.js";import"./flag-GJ94Fqe2.js";import"./hash-Cmnw3-GM.js";import"./users-CXAhoVGa.js";import"./clipboard-list-C2ET-QCv.js";import"./calendar-check-DuYbAMAv.js";import"./user-DKFoNGWn.js";import"./plus-HifIQSWH.js";import"./list-checks-Bum2w6xD.js";import"./user-round-DtkRnRSi.js";const Ze=()=>{const o=Ue({query:"(max-width: 768px)"}),[v,W]=a.useState(""),[S,l]=a.useState(1),[et,tt]=a.useState(""),[X,Y]=a.useState([]),[w,Z]=a.useState(""),[E,ee]=a.useState([]),[c,n]=a.useState(!1),[te,ae]=a.useState(0),[A,se]=a.useState(null),[re,m]=a.useState(!1),[oe,u]=a.useState(!1),[le,de]=a.useState(),[ne,p]=a.useState(!1),[at,st]=a.useState(""),[k,ie]=a.useState(""),[N,ce]=a.useState(""),[C,me]=a.useState(""),[x,ue]=a.useState(8),[_,pe]=a.useState(!1),[D,xe]=a.useState(null),[rt,ot]=a.useState(!1),[g,P]=a.useState({delete_type:"",status:""}),i=M(t=>t.accessToken),F=M(t=>t.staff_id);console.log("staffiddd",F);const{branches:lt,managerOptions:ge,branchCodeOptions:he,fetchBranches:T,isLoading:L}=Re(),fe=[{value:"",label:"All Branches"},{value:"active",label:"Active Branches"},{value:"inactive",label:"Inactive Branches"}],ye=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}];a.useEffect(()=>{T(i)},[i]);const h=async(t=S,s=x,f=v,y=w,O=N,I=C,V=k)=>{var q,R,U,H;n(!0);try{const G=(q=M.getState().permissions[0])==null?void 0:q.role;let d=`${J}/project/task/members/read?page=${t}&limit=${s}`;G!=="superadmin"&&G!=="teamlead"&&(d+=`&staff_id=${F}`),f&&(d+=`&search=${f}`),y&&(d+=`&status=${y}`),O&&(d+=`&manager_id=${O}`),I&&(d+=`&branchcode=${I}`),V&&(d+=`&dec=${V}`);const r=await K.get(d,{headers:{Authorization:`Bearer ${i}`}});console.log("responseeeedatataskview",r),Y((R=r==null?void 0:r.data)==null?void 0:R.data),ae(((U=r==null?void 0:r.data)==null?void 0:U.length)||0),ee(((H=r==null?void 0:r.data)==null?void 0:H.data)||[])}catch(Q){console.error("Error fetching branch list",Q),se("Failed to fetch branches")}finally{n(!1)}};a.useEffect(()=>{h()},[S,v,w,N,C,k,x]);const je=t=>{l(t)},be=()=>{m(!1),b.success("Task added successfully!"),T(i),h()},ve=t=>{W(t),l(1)},Se=t=>{console.log("branchhhhtaskk",t),de(t),u(!0)},we=t=>{p(!0),xe(t)},ke=async()=>{const t={data:{branchcode:D.branchcode,project_code:D.project_code,milestone_code:D.milestone_code,delete_type:g.delete_type,status:g.status}};console.log("projectdeleteddataa",t);try{n(!0);const s=await K.delete(`${J}/project/milestone/delete`,{data:t,headers:{Authorization:`Bearer ${i}`}});console.log("deleteemployeeresponse",s),(s==null?void 0:s.status)===201&&(p(!1),b.success("Milestone Deleted Successfully!"),h(),n(!1),P({delete_type:"",status:""}))}catch(s){console.error("Error deleting milestone",s),b.error("Failed to delete milestone"),n(!1)}finally{n(!1)}},z=t=>{const{name:s,value:f}=t.target;P(y=>({...y,[s]:f}))},Ne=()=>{ie(t=>t==="desc"?"":"desc"),l(1)},Ce=t=>{Z(t),l(1)},_e=t=>{ce(t),l(1)},De=t=>{me(t),l(1)},Te=t=>{ue(t),l(1)},$e=()=>[{data:"id"},{data:"Branch Code"},{data:"Project Code"},{data:"Duration Days"},{data:"Task Name"},{data:"Task Priority"},{data:"Start Date"},{data:"End Date"},{data:"Handle By"},{data:"Status"},{data:"Actions",className:"text-center"}],Be=()=>E?E.map((t,s)=>({id:s+1,data:[{data:t.id},{data:t.branchcode},{data:t.project_code},{data:t.duration_days},{data:t.task_title},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${t.task_priority==="minor"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${t.task_priority==="minor"?"bg-green-800":"bg-red-700"}`}),t.task_priority.charAt(0).toUpperCase()+t.task_priority.slice(1)]})},{data:new Date(t.start_date).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"})},{data:new Date(t.end_date).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"})},{data:t.handler_by},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${t.status==="completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${t.status==="completed"?"bg-green-800":"bg-red-700"}`}),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})},{data:e.jsxs("div",{className:"flex  justify-center gap-2",children:[e.jsx(Pe,{to:`/member_view/${t.participants_id}`,children:e.jsx("button",{className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View",children:e.jsx(We,{size:18})})}),e.jsx("button",{className:"p-1 text-[var(--color-primary)] rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>Se(t),title:"Edit",children:e.jsx(Xe,{size:18})}),e.jsx("button",{className:"p-1 text-red-600 rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>we(t),title:"Delete",children:e.jsx(Ye,{size:18})})]}),className:"action-cell"}]})):[],Me=()=>{u(!1),b.success("Task updated successfully!"),T(i),h()},Ee=()=>{const t=B.book_new(),s=B.json_to_sheet(X);B.book_append_sheet(t,s,"Branches"),Ie(t,"BranchList.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"Task Management"}),o&&e.jsx("button",{onClick:()=>pe(!_),className:"p-2 bg-gray-200 rounded-md",children:_?"Hide Filters":"Show Filters"})]}),e.jsx(qe,{position:Ve,reverseOrder:!1}),e.jsx("div",{className:`flex ${o?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsxs("div",{className:`flex ${o?"flex-col":"flex-row"} gap-4`,children:[e.jsx(j,{options:ye,selectedValue:x,onSelect:Te,placeholder:"Items per page",className:"w-full md:w-[150px]"}),e.jsxs("button",{onClick:Ee,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-3 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(Oe,{className:"mr-1"}),!o&&"Export Excel"]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:[!o&&"Add New Task"," +"]})]})}),e.jsx("div",{className:`${o&&!_?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${o?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(j,{options:fe,selectedValue:w,onSelect:Ce,placeholder:"Branch Status",className:"w-full md:w-[200px]"}),e.jsx(j,{options:he,selectedValue:C,onSelect:De,placeholder:"Branch Code",className:"w-full md:w-[200px]",isLoading:L}),e.jsx(j,{options:ge,selectedValue:N,onSelect:_e,placeholder:"Manager",className:"w-full md:w-[200px]",isLoading:L}),e.jsxs("button",{onClick:Ne,className:`${o?"w-full":"w-[200px]"} h-[40px] text-white bg-[var(--color-primary)] hover-effect px-2 py-1 rounded-sm`,children:["Sort ",k==="desc"?"↑":"↓"]}),e.jsx("div",{className:`${o?"w-full":"w-[200px] mt-3"}`,children:e.jsx(ze,{value:v,onChange:ve,placeholder:"Search branches...",className:"w-full"})})]})}),c&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),A&&e.jsx("div",{className:"text-red-500 text-center py-4",children:A}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Fe,{thead:$e,tbody:Be,responsive:!0,className:"min-w-full"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx(Le,{total:te,currentPage:S,defaultPageSize:x,onChange:je,paginationLabel:"branches",isScroll:!0})})]}),e.jsx($,{isVisible:re,className:"w-full md:w-[800px]",onClose:()=>m(!1),title:"Add New Task Form",children:e.jsx(He,{onSuccess:be,onCancel:()=>m(!1)})}),e.jsx($,{isVisible:oe,className:"w-full md:w-[800px]",onClose:()=>u(!1),title:"Edit Task Form",children:e.jsx(Qe,{taskData:le,onSuccess:Me,onCancel:()=>u(!1)})}),e.jsx($,{isVisible:ne,className:"w-full md:w-[600px]",onClose:()=>p(!1),title:"Drop Milestone",children:e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(Ge,{className:"inline mr-2"})," Drop Milestone"]}),e.jsx("p",{className:"text-gray-500 text-sm font-medium text-center",children:"Are you sure you want to Drop this Milestone?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Je,{className:"inline mr-1",size:14})," Type"]}),e.jsxs("select",{name:"delete_type",value:g.delete_type,onChange:z,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"temp",children:"Temporary"}),e.jsx("option",{value:"permanent",children:"Permanent"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ke,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:g.status,onChange:z,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"revised",children:"Revised"}),e.jsx("option",{value:"client_review",children:"Client_review"}),e.jsx("option",{value:"drop",children:"Drop"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>p(!1),disabled:c,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:ke,disabled:c,children:c?"Processing...":"Confirm"})]})]})})]})},Kt=Ae(Ze);export{Kt as default};
