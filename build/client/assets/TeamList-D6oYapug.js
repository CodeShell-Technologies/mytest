import{w as Re}from"./with-props-DF0D9zIo.js";import{r as s,j as e,u as He}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as Qe}from"./DataTable-DtyPIAGZ.js";import{C as Ge}from"./CustomPagination-CBTcVvJz.js";import{S as Je}from"./SearchInput-CMdOUuSO.js";import{M as G}from"./Modal-BCIUwH-b.js";import{D as V}from"./DrapDown-CEm3nLdF.js";import{F as Ke,u as J,w as We}from"./xlsx-DTxMWUdD.js";import{t as K,a as q,B as P}from"./api-C04JdqFc.js";import{O as W,V as $}from"./index-DxoBGdjx.js";import{B as X}from"./ButtonLoader-Z62NVHwI.js";import{u as B}from"./AuthStore-BnYeBJES.js";import{u as L}from"./useBranchStore-kvv3vD_e.js";import{u as de}from"./useEmployeeStore-BJ_SZO4g.js";import{u as Xe}from"./use-click-outside-BhLpsQYS.js";import{u as ce}from"./UseStaffFilter-Bwbq-nCs.js";import{H as ie}from"./hash-Cmnw3-GM.js";import{U as me}from"./users-CXAhoVGa.js";import{B as ue}from"./building-38OCE1f9.js";import{U as ge}from"./user-DKFoNGWn.js";import{E as Ye}from"./eye-2Mk8PZw-.js";import{S as Ze}from"./square-pen-hueQTsQ_.js";import{T as ea}from"./trash-2-AUNIB88j.js";import"./index-knF4tUPh.js";/* empty css            */import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";/* empty css                         */import"./moment-C5S46NFB.js";const aa=({onSuccess:n,onCancel:N})=>{const[k,o]=s.useState(!1),[l,S]=s.useState(null),z=B(r=>r.accessToken);L(r=>r.branchCodeOptions),de(r=>r.branchEmployeeOptions);const w=B(r=>r.permissions)[0].role,C=L(r=>r.branchCodeOptions),O=B(r=>r.branchcode),f=w==="superadmin"?C:[{value:O,label:O}],[h,u]=s.useState({team_name:"",team_lead:"",branchcode:""}),d=r=>{const{name:t,value:c}=r.target;u(i=>({...i,[t]:c}))},{departmentOptions:T,selectedDepartment:_,staffOptions:g,isFetchingStaff:y,handleDepartmentChange:F}=ce(h.branchcode),j=async r=>{var c,i;r.preventDefault(),o(!0);const t={userDatas:[h]};try{const m=await q.post(`${P}/teams/create`,t,{headers:{Authorization:`Bearer ${z}`}});m.status===201?n():S(m.data.message||"Failed to create Team")}catch(m){S(((i=(c=m.response)==null?void 0:c.data)==null?void 0:i.message)||"An error occurred"),$.error(`${l}, Error in create Team`,{style:{border:"1px solid  rgb(185 28 28)",padding:"14px",width:"900px",color:" rgb(185 28 28)"},iconTheme:{primary:" rgb(185 28 28)",secondary:"#FFFAEE"}})}finally{o(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsx(W,{position:K}),l&&e.jsx("div",{className:"text-red-500 mb-4",children:l}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Team Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ie,{className:"inline mr-1",size:14})," Branch Code"]}),e.jsxs("select",{name:"branchcode",value:h.branchcode,onChange:d,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),f==null?void 0:f.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Team Name"]}),e.jsx("input",{name:"team_name",value:h.team_name,onChange:d,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"text",placeholder:"Team Name",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ue,{className:"inline mr-1",size:14})," Department"]}),e.jsxs("select",{value:_,onChange:r=>{F(r.target.value),u(t=>({...t,handler_by:"",handler_to:""}))},className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),T.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ge,{className:"inline mr-1",size:14})," Select Team Lead"]}),y?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading staff..."}):e.jsxs("select",{name:"team_lead",value:h.team_lead,onChange:d,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!_||g.length===0,children:[e.jsx("option",{value:"",children:"Select Staff"}),g.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),_&&g.length===0&&!y&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No staff found in this department"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:N,disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",disabled:k,children:k?e.jsx(X,{}):"Create Team"})]})]})]})};function ta({branch:n,onSuccess:N,onCancel:k}){const[o,l]=s.useState({team_id:"",team_name:"",team_lead:"",branchcode:""}),[S,z]=s.useState(!1),[E,w]=s.useState(null),C=B(t=>t.accessToken);L(t=>t.branchCodeOptions),de(t=>t.branchEmployeeOptions);const f=B(t=>t.permissions)[0].role,h=L(t=>t.branchCodeOptions),u=B(t=>t.branchcode),d=f==="superadmin"?h:[{value:u,label:u}];s.useEffect(()=>{n&&l({team_id:n.team_id||"",team_name:n.team_name||"",team_lead:n.team_lead||"",branchcode:n.branchcode||""})},[n]);const T=t=>{const{name:c,value:i}=t.target;l(m=>({...m,[c]:i}))},{departmentOptions:_,selectedDepartment:g,staffOptions:y,isFetchingStaff:F,handleDepartmentChange:j}=ce(o.branchcode),r=async t=>{var i,m;t.preventDefault(),z(!0);const c={userData:{team_id:o.team_id,team_name:o.team_name,team_lead:o.team_lead,branchcode:o.branchcode}};try{const p=await q.put(`${P}/teams/edit`,c,{headers:{Authorization:`Bearer ${C}`}});p.status===201?N():w(p.data.message||"Failed to update team")}catch(p){w(((m=(i=p.response)==null?void 0:i.data)==null?void 0:m.message)||"An error occurred"),$.error(`${E}, Error in update team`,{style:{border:"1px solid  rgb(185 28 28)",padding:"14px",width:"900px",color:" rgb(185 28 28)"},iconTheme:{primary:" rgb(185 28 28)",secondary:"#FFFAEE"}}),w(null)}finally{z(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[E&&e.jsx("div",{className:"text-red-500 mb-4",children:E}),e.jsx(W,{position:K}),e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Edit Team Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ie,{className:"inline mr-1",size:14})," Branch Code"]}),e.jsxs("select",{name:"branchcode",value:o.branchcode,onChange:T,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),d==null?void 0:d.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Team Name"]}),e.jsx("input",{name:"team_name",value:o.team_name,onChange:T,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"text",placeholder:"Team Name",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ue,{className:"inline mr-1",size:14})," Department"]}),e.jsxs("select",{value:g,onChange:t=>{j(t.target.value),l(c=>({...c,handler_by:"",handler_to:""}))},className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ge,{className:"inline mr-1",size:14})," Select Team Lead"]}),F?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading staff..."}):e.jsxs("select",{name:"team_lead",value:o.team_lead,onChange:T,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!g||y.length===0,children:[e.jsx("option",{value:"",children:"Select Staff"}),y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),g&&y.length===0&&!F&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No staff found in this department"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:k,disabled:S,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",disabled:S,children:S?e.jsx(X,{}):"Update Team"})]})]})]})}const ra=()=>{const n=Xe({query:"(max-width: 768px)"}),[N,k]=s.useState(""),[o,l]=s.useState(1),[S,z]=s.useState(""),[E,w]=s.useState([]),[C,O]=s.useState(""),[f,h]=s.useState([]),[u,d]=s.useState(!1),[T,_]=s.useState(0),[g,y]=s.useState(null),[F,j]=s.useState(!1),[r,t]=s.useState(!1),[c,i]=s.useState(),[m,p]=s.useState(!1),[xe,he]=s.useState(""),[pe,be]=s.useState(""),[U,fe]=s.useState(""),[R,ye]=s.useState(""),[H,je]=s.useState(""),[M,ve]=s.useState(8),[Q,Ne]=s.useState(!1),ke=He(),D=B(a=>a.accessToken),{branches:sa,managerOptions:Se,branchCodeOptions:we,fetchBranches:A,isLoading:Y}=L(),Ce=[{value:"",label:"All Branches"},{value:"active",label:"Active Branches"},{value:"inactive",label:"Inactive Branches"}],Te=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}];s.useEffect(()=>{A(D)},[D]);const I=async(a=o,b=M,Z=N,ee=C,ae=R,te=H,re=U)=>{var se,ne,oe,le;d(!0);try{let v=`${P}/teams/read?page=${a}&limit=${b}`;Z&&(v+=`&search=${Z}`),ee&&(v+=`&status=${ee}`),ae&&(v+=`&manager_id=${ae}`),te&&(v+=`&branchcode=${te}`),re&&(v+=`&dec=${re}`);const x=await q.get(v,{headers:{Authorization:`Bearer ${D}`}});console.log("responseeeforteam>>>>>>",x),w((se=x==null?void 0:x.data)==null?void 0:se.data),_(((oe=(ne=x==null?void 0:x.data)==null?void 0:ne.data)==null?void 0:oe.totalDocuments)||0),h(((le=x==null?void 0:x.data)==null?void 0:le.data)||[])}catch(v){console.error("Error fetching branch list",v),y("Failed to fetch branches")}finally{d(!1)}};s.useEffect(()=>{I()},[o,N,C,R,H,U,M]);const _e=a=>{l(a)},De=()=>{j(!1),$.success("Team added successfully!"),A(D),I()},Be=a=>{k(a),l(1)},Ee=a=>{i(a),t(!0)},Fe=a=>{p(!0),he(a.team_id),be(a.branchcode)},$e=async()=>{const a={userData:{team_id:xe,branchcode:pe}};console.log("deletedcodeformdata",a);try{d(!0);const b=await q.delete(`${P}/teams/delete`,{data:a,headers:{Authorization:`Bearer ${D}`}});(b==null?void 0:b.status)===201&&(p(!1),$.success("Team deleted successfully!"),A(D),I())}catch(b){console.error("Error deleting team",b),$.error("Failed to delete team")}finally{d(!1)}},ze=()=>{fe(a=>a==="desc"?"":"desc"),l(1)},Oe=a=>{O(a),l(1)},Le=a=>{ye(a),l(1)},Me=a=>{je(a),l(1)},Ae=a=>{ve(a),l(1)},Ie=a=>{console.log("editprofileidd",a),alert("navigateactive"),ke(`/teamview/${encodeURIComponent(a)}`)},Ve=()=>[{data:"Team Id"},{data:"Team Name"},{data:"Team Lead Id"},{data:"Branch Code"},{data:"Created Date"},{data:"Actions",className:"text-center"}],qe=()=>f?f.map(a=>({id:a.id,data:[{data:a.team_id},{data:a.team_name},{data:a.team_lead},{data:a.branchcode},{data:new Date(a.created_on).toISOString().split("T")[0]},{data:e.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[e.jsx("button",{className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View",onClick:()=>Ie(a.team_id),children:e.jsx(Ye,{size:18})}),e.jsx("button",{className:"p-1 text-[var(--color-primary)] rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>Ee(a),title:"Edit",children:e.jsx(Ze,{size:18})}),e.jsx("button",{className:"p-1 text-red-600 rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>Fe(a),title:"Delete",children:e.jsx(ea,{size:18})})]}),className:"action-cell"}]})):[],Pe=()=>{t(!1),$.success("Team updated successfully!"),A(D),I()},Ue=()=>{const a=J.book_new(),b=J.json_to_sheet(E);J.book_append_sheet(a,b,"Branches"),We(a,"BranchList.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"Team Management"}),n&&e.jsx("button",{onClick:()=>Ne(!Q),className:"p-2 bg-gray-200 rounded-md",children:Q?"Hide Filters":"Show Filters"})]}),e.jsx(W,{position:K,reverseOrder:!1}),e.jsx("div",{className:`flex ${n?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsxs("div",{className:`flex ${n?"flex-col":"flex-row"} gap-4`,children:[e.jsx(V,{options:Te,selectedValue:M,onSelect:Ae,placeholder:"Items per page",className:"w-full md:w-[150px]"}),e.jsxs("button",{onClick:Ue,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-3 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(Ke,{className:"mr-1"}),!n&&"Export Excel"]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:[!n&&"New Team"," +"]})]})}),e.jsx("div",{className:`${n&&!Q?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${n?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(V,{options:Ce,selectedValue:C,onSelect:Oe,placeholder:"Branch Status",className:"w-full md:w-[200px]"}),e.jsx(V,{options:we,selectedValue:H,onSelect:Me,placeholder:"Branch Code",className:"w-full md:w-[200px]",isLoading:Y}),e.jsx(V,{options:Se,selectedValue:R,onSelect:Le,placeholder:"Manager",className:"w-full md:w-[200px]",isLoading:Y}),e.jsxs("button",{onClick:ze,className:`${n?"w-full":"w-[200px]"} h-[40px] text-white bg-[var(--color-primary)] hover-effect px-2 py-1 rounded-sm`,children:["Sort ",U==="desc"?"↑":"↓"]}),e.jsx("div",{className:`${n?"w-full":"w-[200px] mt-3"}`,children:e.jsx(Je,{value:N,onChange:Be,placeholder:"Search branches...",className:"w-full"})})]})}),u&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),g&&e.jsx("div",{className:"text-red-500 text-center py-4",children:g}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Qe,{thead:Ve,tbody:qe,responsive:!0,className:"min-w-full"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx(Ge,{total:T,currentPage:o,defaultPageSize:M,onChange:_e,paginationLabel:"branches",isScroll:!0})})]}),e.jsx(G,{isVisible:F,className:"w-full md:w-[800px]",onClose:()=>j(!1),title:"Create New Team",children:e.jsx(aa,{onSuccess:De,onCancel:()=>j(!1)})}),e.jsx(G,{isVisible:r,className:"w-full md:w-[800px]",onClose:()=>t(!1),title:"Edit Team",children:e.jsx(ta,{branch:c,onSuccess:Pe,onCancel:()=>t(!1)})}),e.jsx(G,{isVisible:m,className:"w-full md:w-[600px]",onClose:()=>p(!1),title:"Delete Team",children:e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:"Confirm Deletion"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Are you sure you want to delete this team? This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-center gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>p(!1),disabled:u,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:$e,disabled:u,children:u?e.jsx(X,{}):"Delete Team"})]})]})})]})},La=Re(ra);export{La as default};
