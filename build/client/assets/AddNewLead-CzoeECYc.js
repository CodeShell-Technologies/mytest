import{r as o,j as e}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{a as S,B as _,t as P}from"./api-C04JdqFc.js";import{V as E,O as $}from"./index-DxoBGdjx.js";import{B as R}from"./ButtonLoader-Z62NVHwI.js";import{u as h}from"./AuthStore-BnYeBJES.js";import"./LeadsStore-C-d0npQs.js";import{u as U}from"./useBranchStore-kvv3vD_e.js";import{u as M}from"./useEmployeeStore-BJ_SZO4g.js";import{u as H}from"./UseStaffFilter-Bwbq-nCs.js";import{B as V}from"./book-user-BTUNghSh.js";import{H as B}from"./hash-Cmnw3-GM.js";import{U as z}from"./user-DKFoNGWn.js";import{P as W,M as G}from"./phone-iHDF8fYQ.js";import{C as J}from"./calendar-check-DuYbAMAv.js";import{B as K}from"./building-38OCE1f9.js";import{T as y}from"./tag-hjf6KM-t.js";import{B as Q}from"./book-open-text-CwD5ICOx.js";const pe=({onSuccess:F,onCancel:L})=>{const[c,b]=o.useState(!1),[A,f]=o.useState(null),[m,l]=o.useState([]),[j,v]=o.useState(!1),k=h(a=>a.accessToken),N=h(a=>a.permissions)[0].role,q=U(a=>a.branchCodeOptions),g=h(a=>a.branchcode),x=N==="superadmin"?q:[{value:g,label:g}];M(a=>a.branchEmployeeOptions);const[r,C]=o.useState({branchcode:N==="superadmin"?"":g,campaign_code:"",lead_date:new Date().toISOString().split("T")[0],lead_name:"",phone:"",email:"",assignee_id:"",comm_type:"",proj_type:"",status:"active",summary:""}),{departmentOptions:D,selectedDepartment:u,staffOptions:p,isFetchingStaff:w,handleDepartmentChange:O}=H(r.branchcode);o.useEffect(()=>{r.branchcode?T(r.branchcode):l([])},[r.branchcode]);const T=async a=>{v(!0);try{const s=await S.get(`${_}/campaign/overview/dropdown?branchcode=${a}`,{headers:{Authorization:`Bearer ${k}`}});if(s.data&&s.data.data){const d=s.data.data.map(n=>({value:n.campaign_code,label:n.campaignname}));l(d)}else l([])}catch{E.error("Failed to fetch campaign options",{style:{border:"1px solid rgb(185 28 28)",padding:"14px",color:"rgb(185 28 28)"},iconTheme:{primary:"rgb(185 28 28)",secondary:"#FFFAEE"}}),l([])}finally{v(!1)}},t=a=>{const{name:s,value:d}=a.target;C(n=>({...n,[s]:d}))},I=async a=>{var d,n;a.preventDefault(),b(!0);const s={data:[r]};try{const i=await S.post(`${_}/campaign/leads/create`,s,{headers:{Authorization:`Bearer ${k}`}});i.status===201?F():f(i.data.message||"Failed to create lead")}catch(i){f(((n=(d=i.response)==null?void 0:d.data)==null?void 0:n.message)||"An error occurred"),E.error(A||"Error creating lead")}finally{b(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsx($,{position:P}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(V,{className:"inline mr-2"})," Lead Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(B,{className:"inline mr-1",size:14})," Branch Code ",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsxs("select",{name:"branchcode",value:r.branchcode,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),x==null?void 0:x.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(B,{className:"inline mr-1",size:14})," Campaign Code"]}),j?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading campaigns..."}):e.jsxs("select",{name:"campaign_code",value:r.campaign_code,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!r.branchcode||m.length===0,children:[e.jsx("option",{value:"",children:"Select Campaign"}),m.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),r.branchcode&&m.length===0&&!j&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No campaigns found for this branch"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(z,{className:"inline mr-1",size:14})," Lead Name",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"lead_name",value:r.lead_name,onChange:t,type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter lead name",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(W,{className:"inline mr-1",size:14})," Phone ",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"phone",value:r.phone,onChange:t,type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(G,{className:"inline mr-1",size:14})," Email",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"email",value:r.email,onChange:t,type:"email",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter email"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(J,{className:"inline mr-1",size:14})," Lead Date",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"lead_date",value:r.lead_date,onChange:t,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(K,{className:"inline mr-1",size:14})," Department ",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsxs("select",{value:u,onChange:a=>{O(a.target.value),C(s=>({...s,assignee_id:""}))},className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),D.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(z,{className:"inline mr-1",size:14})," Assigned To ",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),w?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading staff..."}):e.jsxs("select",{name:"assignee_id",value:r.assignee_id,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!u||p.length===0,children:[e.jsx("option",{value:"",children:"Select Staff"}),p.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),u&&p.length===0&&!w&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No staff found in this department"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(y,{className:"inline mr-1",size:14})," Communication Type"]}),e.jsxs("select",{name:"comm_type",value:r.comm_type,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"call",children:"Phone Call"}),e.jsx("option",{value:"sms",children:"SMS"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp"}),e.jsx("option",{value:"in-person",children:"In-Person"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(y,{className:"inline mr-1",size:14})," Project Type"]}),e.jsxs("select",{name:"proj_type",value:r.proj_type,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"residential",children:"Residential"}),e.jsx("option",{value:"commercial",children:"Commercial"}),e.jsx("option",{value:"industrial",children:"Industrial"}),e.jsx("option",{value:"land",children:"Land"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(y,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:r.status,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"converted",children:"Converted"}),e.jsx("option",{value:"lost",children:"Lost"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(Q,{className:"inline mr-2"})," Notes & Summary"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:e.jsx("textarea",{name:"summary",value:r.summary,onChange:t,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[100px]",placeholder:"Enter lead summary and notes..."})})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:L,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",onClick:I,className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-800 dark:hover:bg-red-900 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",disabled:c,children:c?e.jsx(R,{}):"Create Lead"})]})]})};export{pe as A};
