import{w as ta}from"./with-props-DF0D9zIo.js";import{r as t,j as e,u as ra,b as sa}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as Le}from"./DataTable-DtyPIAGZ.js";import{C as Oe}from"./CustomPagination-CBTcVvJz.js";import{S as Re}from"./SearchInput-CMdOUuSO.js";import{M as se}from"./Modal-BCIUwH-b.js";import{D as O}from"./DrapDown-CEm3nLdF.js";import{F as Ve,u as J,w as Ue}from"./xlsx-DTxMWUdD.js";import{a as K,B as W,t as He}from"./api-C04JdqFc.js";import{V as _,O as Ge}from"./index-DxoBGdjx.js";import{u as X}from"./AuthStore-BnYeBJES.js";import{u as na}from"./useBranchStore-kvv3vD_e.js";import"./useEmployeeStore-BJ_SZO4g.js";import{u as Qe}from"./use-click-outside-BhLpsQYS.js";import{A as da}from"./AddNewProject-BwdU85rY.js";import{a as oa}from"./ProjectStore-Bmk5yusB.js";import"./LeadsStore-C-d0npQs.js";import{P as la}from"./ProjectMeetingForm-7pSkeH58.js";import{a as ia}from"./index-DTbJanog.js";import{B as ca}from"./ButtonLoader-Z62NVHwI.js";import{u as ma}from"./UseStaffFilter-Bwbq-nCs.js";import{f as Me}from"./dateUtils-CBplQNBw.js";import{F as ua}from"./file-text-BNGbNc3I.js";import{C as _e}from"./calendar-check-DuYbAMAv.js";import{P as Ee}from"./percent-PG9oKso6.js";import{T as Pe}from"./tag-hjf6KM-t.js";import{B as Ce}from"./banknote-DmPEdTMl.js";import{L as Te}from"./list-checks-Bum2w6xD.js";import{B as ga}from"./building-38OCE1f9.js";import{U as Ie}from"./user-DKFoNGWn.js";import{C as xa}from"./clipboard-list-C2ET-QCv.js";import{D as pa}from"./dollar-sign-D2IX7NrM.js";import{E as Je}from"./eye-2Mk8PZw-.js";import{N as ya}from"./network-4iL8t-Of.js";import{C as ha}from"./clipboard-type-fPi_05HQ.js";import{T as ba}from"./trash-2-AUNIB88j.js";import"./index-knF4tUPh.js";/* empty css            */import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";/* empty css                         */import"./moment-C5S46NFB.js";import"./book-user-BTUNghSh.js";import"./hash-Cmnw3-GM.js";import"./briefcase-B0VTTUxq.js";import"./book-open-text-CwD5ICOx.js";import"./video-BzePKQuD.js";import"./file-QxKA-9Fo.js";import"./calendar-C_LRGMui.js";import"./clock-CzOQJT5p.js";import"./users-CXAhoVGa.js";import"./x-BfrbTbzo.js";import"./chevron-up-DjUqBI0v.js";import"./chevron-down-DOBgonSl.js";import"./plus-HifIQSWH.js";const fa=({project:i,onSuccess:C,onCancel:Y})=>{var V;const[j,m]=t.useState(!1),[E,x]=t.useState(null),[A,Z]=t.useState([]),P=X(s=>s.accessToken),{departmentOptions:R,selectedDepartment:v,staffOptions:N,isFetchingStaff:b,handleDepartmentChange:k}=ma(i.branchcode),[l,D]=t.useState({project_code:i.project_code,project_amount:i.budget||0,invoice_no:"",invoice_date:new Date().toISOString().split("T")[0],due_date:"",cgst_percentage:0,sgst_percentage:0,discount:0,roundoff:0,paid_amount:0,balance_amount:i.budget||0,notes:"",created_by:((V=X.getState().user)==null?void 0:V.staff_id)||"",approved_staff_id:"",data:[]});t.useEffect(()=>{const s=async()=>{try{const n=await K.get(`${W}/project/milestone/dropdown?project_code=${i.project_code}`,{headers:{Authorization:`Bearer ${P}`}});if(n.data&&n.data.data){Z(n.data.data);const c=n.data.data.map(d=>({milestone_code:d.milestone_code,milestone_amount:d.base_amount||0,notes:"",due_date:d.end_date||"",permission:!1,isrevised:!1}));D(d=>({...d,data:c,due_date:n.data.data.length>0&&n.data.data[n.data.data.length-1].end_date||""}))}}catch(n){console.error("Error fetching milestones:",n),_.error("Failed to load milestones")}};i.project_code&&s()},[i.project_code,P]);const p=(s,n)=>{const{name:c,value:d,type:y,checked:h}=n.target,U=[...l.data];U[s]={...U[s],[c]:y==="checkbox"?h:d},D(w=>({...w,data:U}))},u=s=>{const{name:n,value:c}=s.target;if(n==="paid_amount"){const d=parseFloat(c)||0,y=(parseFloat(l.project_amount)||0)-d;D(h=>({...h,[n]:c,balance_amount:y.toFixed(2)}))}else D(d=>({...d,[n]:c}))},T=()=>{if(!l.approved_staff_id)return x("Approved staff is required"),!1;if(!l.invoice_no)return x("Invoice number is required"),!1;if(!l.invoice_date)return x("Invoice date is required"),!1;if(!l.due_date)return x("Due date is required"),!1;if(l.data.length===0)return x("At least one milestone is required"),!1;for(const s of l.data){if(!s.due_date)return x("Due date is required for all milestones"),!1;if(!s.milestone_amount||isNaN(s.milestone_amount)||s.milestone_amount<=0)return x("Valid amount is required for all milestones"),!1}return!0},z=async s=>{var n,c,d,y;if(s.preventDefault(),m(!0),x(null),!T()){m(!1);return}try{const h=await K.post(`${W}/project/req/create`,l,{headers:{Authorization:`Bearer ${P}`}});h.status===201?(_.success("Payment request created successfully!"),C()):x(h.data.message||"Failed to create payment request")}catch(h){x(((c=(n=h.response)==null?void 0:n.data)==null?void 0:c.message)||"An error occurred"),_.error(((y=(d=h.response)==null?void 0:d.data)==null?void 0:y.message)||"Error creating payment request")}finally{m(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[E&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:E}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Project Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Project Code"}),e.jsx("input",{value:l.project_code,readOnly:!0,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none cursor-not-allowed"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Project Amount"}),e.jsx("input",{name:"project_amount",value:l.project_amount,onChange:u,type:"number",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Project Duration"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mt-1",children:[Me(i.start_date)," - ",Me(i.end_date)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Invoice Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ua,{className:"inline mr-1",size:14})," Invoice Number"]}),e.jsx("input",{name:"invoice_no",value:l.invoice_no,onChange:u,type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter invoice number",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(_e,{className:"inline mr-1",size:14})," Invoice Date"]}),e.jsx("input",{name:"invoice_date",value:l.invoice_date,onChange:u,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(_e,{className:"inline mr-1",size:14})," Due Date"]}),e.jsx("input",{name:"due_date",value:l.due_date,onChange:u,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ee,{className:"inline mr-1",size:14})," CGST (%)"]}),e.jsx("input",{name:"cgst_percentage",value:l.cgst_percentage,onChange:u,type:"number",step:"0.01",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"CGST percentage"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ee,{className:"inline mr-1",size:14})," SGST (%)"]}),e.jsx("input",{name:"sgst_percentage",value:l.sgst_percentage,onChange:u,type:"number",step:"0.01",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"SGST percentage"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Pe,{className:"inline mr-1",size:14})," Discount"]}),e.jsx("input",{name:"discount",value:l.discount,onChange:u,type:"number",step:"0.01",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Discount amount"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Pe,{className:"inline mr-1",size:14})," Round Off"]}),e.jsx("input",{name:"roundoff",value:l.roundoff,onChange:u,type:"number",step:"0.01",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Round off amount"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ce,{className:"inline mr-1",size:14})," Paid Amount"]}),e.jsx("input",{name:"paid_amount",value:l.paid_amount,onChange:u,type:"number",step:"0.01",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Amount already paid"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ce,{className:"inline mr-1",size:14})," Balance Amount"]}),e.jsx("input",{name:"balance_amount",value:l.balance_amount,readOnly:!0,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none cursor-not-allowed"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Te,{className:"inline mr-1",size:14})," Notes"]}),e.jsx("textarea",{name:"notes",value:l.notes,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Additional notes",rows:3})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Approval Information"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ga,{className:"inline mr-1",size:14})," Department"]}),e.jsxs("select",{value:v,onChange:s=>{k(s.target.value),D(n=>({...n,approved_staff_id:""}))},className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ie,{className:"inline mr-1",size:14})," Created By"]}),b?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading staff..."}):e.jsxs("select",{name:"created_by",value:l.created_by,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!v||N.length===0,children:[e.jsx("option",{value:"",children:"Select Staff"}),N.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),v&&N.length===0&&!b&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No staff found in this department"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ie,{className:"inline mr-1",size:14})," Approved Staff"]}),b?e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading staff..."}):e.jsxs("select",{name:"approved_staff_id",value:l.approved_staff_id,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!v||N.length===0,children:[e.jsx("option",{value:"",children:"Select Staff"}),N.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),v&&N.length===0&&!b&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No staff found in this department"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Milestone Payments"}),A.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No milestones found for this project"}):l.data.map((s,n)=>{var c;return e.jsxs("div",{className:"border rounded-lg p-4 dark:border-gray-700",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(xa,{size:16}),((c=A[n])==null?void 0:c.miles_title)||`Milestone ${n+1}`,e.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded ml-2",children:s.milestone_code})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ce,{className:"inline mr-1",size:14})," Amount"]}),e.jsx("input",{name:"milestone_amount",value:s.milestone_amount,onChange:d=>p(n,d),type:"number",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter amount"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(_e,{className:"inline mr-1",size:14})," Due Date"]}),e.jsx("input",{name:"due_date",value:s.due_date,onChange:d=>p(n,d),type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Te,{className:"inline mr-1",size:14})," Notes"]}),e.jsx("input",{name:"notes",value:s.notes,onChange:d=>p(n,d),type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Payment notes"})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"permission",checked:s.permission,onChange:d=>p(n,d),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),"Permission"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"isrevised",checked:s.isrevised,onChange:d=>p(n,d),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),"Is Revised"]})]})]})]},n)})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:Y,children:"Cancel"}),e.jsx("button",{type:"submit",onClick:z,disabled:j||A.length===0,className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-800 dark:hover:bg-red-900 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm disabled:opacity-70",children:j?e.jsx(ca,{}):"Create Payment Request"})]})]})},ja=()=>{var ce;const i=Qe({query:"(max-width: 768px)"}),[C,Y]=t.useState(""),[j,m]=t.useState(1),[E,x]=t.useState(""),[A,Z]=t.useState([]),[P,R]=t.useState(!1),[v,N]=t.useState(0),[b,k]=t.useState(null),[l,D]=t.useState(""),[p,u]=t.useState(8),[T,z]=t.useState(!1),[V,s]=t.useState([]),[n,c]=t.useState(!1),[d,y]=t.useState(null),[h,U]=t.useState(!1),[w,he]=t.useState({invoice_id:"",paid_amount:"",payment_mode:"upi",notes:""}),H=X(r=>r.accessToken),ee=X(r=>r.role),ae="BRANCH-03",ne=ra(),G=[{value:"",label:"All Status"},{value:"raised",label:"Raised"},{value:"partially_paid",label:"Partially Paid"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}],be=[{value:"upi",label:"UPI"},{value:"bank_transfer",label:"Bank Transfer"},{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"}],te=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}],de=async(r=j,o=p,$=C,S=E,Se=l)=>{var me,ue,ge;R(!0);try{let q=`${W}/project/invoice/read?page=${r}&limit=${o}`;$&&(q+=`&search=${$}`),S&&(q+=`&status=${S}`);const xe=ee==="superadmin"?Se:ae;xe&&(q+=`&branchcode=${xe}`);const f=await K.get(q,{headers:{Authorization:`Bearer ${H}`}});s(((me=f==null?void 0:f.data)==null?void 0:me.data)||[]),N(((ue=f==null?void 0:f.data)==null?void 0:ue.totalDocuments)||0),Z(((ge=f==null?void 0:f.data)==null?void 0:ge.data)||[])}catch(q){console.error("Error fetching payments",q),k("Failed to fetch payments")}finally{R(!1)}},F=r=>{y(r),console.log("invoiceehabndleee",r);const o=r.invoice.invoice_id;ne(`/payreq_view/${encodeURIComponent(o)}`)},fe=r=>{console.log("invoiceehabndleee",r);const o=r.invoice.invoice_id;ne(`/invoice_view/${encodeURIComponent(o)}`)},re=async r=>{var o,$;r.preventDefault();try{(await K.post(`${W}/project/invoice/payment`,w,{headers:{Authorization:`Bearer ${H}`}})).status===201&&(_.success("Payment recorded successfully!"),c(!1),de())}catch(S){console.error("Error recording payment",S),_.error((($=(o=S.response)==null?void 0:o.data)==null?void 0:$.message)||"Failed to record payment")}},I=r=>{const{name:o,value:$}=r.target;he(S=>({...S,[o]:$}))};t.useEffect(()=>{de()},[j,C,E,l,p,ee]);const je=r=>{m(r)},Q=r=>{Y(r),m(1)},oe=r=>{x(r),m(1)},ve=r=>{D(r),m(1)},Ne=r=>{u(r),m(1)},ke=()=>{const r=J.book_new(),o=J.json_to_sheet(V);J.book_append_sheet(r,o,"Payments"),Ue(r,"PaymentList.xlsx")},L=r=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(parseFloat(r||"0")),le=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ie=()=>[{data:"Invoice No"},{data:"Client"},{data:"Project"},{data:"Total Amount"},{data:"Paid Amount"},{data:"Balance"},{data:"Status"},{data:"Due Date"},{data:"Actions"}],we=()=>A?A.map(r=>{const o=r.invoice;return r.milestone_requests[0],{id:o.invoice_id,data:[{data:o.invoice_no},{data:o.client_name},{data:o.project_title},{data:L(o.total_amount)},{data:L(o.paid_amount)},{data:L(o.balance_amount)},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${o.status==="paid"?"bg-green-100 text-green-800 dark:bg-green-800/25 dark:text-green-400":o.status==="cancelled"?"bg-red-100 text-red-800 dark:bg-red-800/25 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-800/25 dark:text-blue-300"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${o.status==="paid"?"bg-green-800 dark:bg-green-400":o.status==="cancelled"?"bg-red-800 dark:bg-red-400":"bg-blue-800 dark:bg-blue-400"}`}),o.status.charAt(0).toUpperCase()+o.status.slice(1)]})},{data:le(o.due_date)},{data:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>F(r),className:"p-1 text-red-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"Record Payment",children:e.jsx(pa,{size:18})}),e.jsx("button",{onClick:()=>fe(r),className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View Invoice",children:e.jsx(Je,{size:18})})]}),className:"action-cell"}]}}):[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"Payment Management"}),i&&e.jsx("button",{onClick:()=>z(!T),className:"p-2 bg-gray-200 rounded-md",children:T?"Hide Filters":"Show Filters"})]}),e.jsx(Ge,{position:He,reverseOrder:!1}),e.jsx("div",{className:`flex ${i?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsxs("div",{className:`flex ${i?"flex-col":"flex-row"} gap-4`,children:[e.jsx(O,{options:te,selectedValue:p,onSelect:Ne,placeholder:"Items per page",className:"w-full md:w-[150px]"}),e.jsxs("button",{onClick:ke,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-3 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(Ve,{className:"mr-1"}),!i&&"Export Excel"]})]})}),e.jsx("div",{className:`${i&&!T?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${i?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(O,{options:G,selectedValue:E,onSelect:oe,placeholder:"Payment Status",className:"w-full md:w-[200px]"}),ee==="superadmin"&&e.jsx(O,{options:[{value:"",label:"All Branches"},{value:"BRANCH-03",label:"BRANCH-03"},{value:"BRCH_02",label:"BRCH_02"}],selectedValue:l,onSelect:ve,placeholder:"Branch Code",className:"w-full md:w-[200px]"}),e.jsx("div",{className:`${i?"w-full":"w-[200px] mt-3"}`,children:e.jsx(Re,{value:C,onChange:Q,placeholder:"Search payments...",className:"w-full"})})]})}),P&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),b&&e.jsx("div",{className:"text-red-500 text-center py-4",children:b}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Le,{thead:ie,tbody:we,responsive:!0,className:"min-w-full"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx(Oe,{total:v,currentPage:j,defaultPageSize:p,onChange:je,paginationLabel:"payments",isScroll:!0})})]}),e.jsx(se,{isVisible:n,className:"w-full md:w-[600px]",onClose:()=>c(!1),title:`Record Payment for ${((ce=d==null?void 0:d.invoice)==null?void 0:ce.invoice_no)||""}`,children:e.jsx("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:e.jsxs("form",{onSubmit:re,children:[e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Total Amount"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mt-1",children:L(d.invoice.total_amount)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Balance Amount"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mt-1",children:L(d.invoice.balance_amount)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Paid Amount"}),e.jsx("input",{name:"paid_amount",value:w.paid_amount,onChange:I,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"number",placeholder:"Amount",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Payment Mode"}),e.jsx("select",{name:"payment_mode",value:w.payment_mode,onChange:I,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:be.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Notes"}),e.jsx("textarea",{name:"notes",value:w.notes,onChange:I,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[80px]",placeholder:"Payment notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",children:"Record Payment"})]})]})})})]})},va=()=>{const i=Qe({query:"(max-width: 768px)"}),[C,Y]=t.useState(""),[j,m]=t.useState(1),[E,x]=t.useState(""),[A,Z]=t.useState([]),[P,R]=t.useState(""),[v,N]=t.useState([]),[b,k]=t.useState(!1),[l,D]=t.useState(0),[p,u]=t.useState(null),[T,z]=t.useState(!1),[V,s]=t.useState(!1),[n,c]=t.useState(),[d,y]=t.useState(!1),[h,U]=t.useState(null),[w,he]=t.useState(""),[H,ee]=t.useState(""),[ae,ne]=t.useState(""),[G,be]=t.useState(8),[te,de]=t.useState(!1),F=X(a=>a.accessToken),[fe,re]=t.useState(!1),[I,je]=t.useState("projectlist"),[Q,oe]=t.useState({delete_type:"",status:""}),{fetchProject:ve}=oa(),Ne=X(a=>a.branchcode),ke=[{id:"projectlist",label:"Project List"},{id:"payrequest",label:"Invoice List"}],{branchCodeOptions:L,fetchBranches:le,isLoading:ie}=na(),we=[{value:"",label:"All Priority"},{value:"minor",label:"Minor Projects"},{value:"major",label:"Major Project"},{value:"critical",label:"Critical Project"},{value:"blocker",label:"Blocker Project"}],ce=[{value:"",label:"All Projects"},{value:"active",label:"Active Projects"},{value:"draft",label:"Draft Project"},{value:"planning",label:"planning Project"},{value:"paused",label:"paused Project"},{value:"completed",label:"completed Project"},{value:"revised",label:"revised Project"},{value:"client_review",label:"client_review Project"},{value:"drop",label:"drop Project"}],r=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}];t.useEffect(()=>{ve(F,Ne)},[F]);const o=async(a=j,g=G,pe=C,ye=P,$e=H,Be=ae,Ae=w)=>{var ze,Fe,qe;k(!0);try{let M=`${W}/project/overview/read?page=${a}&limit=${g}`;pe&&(M+=`&search=${pe}`),ye&&(M+=`&status=${ye}`),$e&&(M+=`&priority=${$e}`),Be&&(M+=`&branchcode=${Be}`),Ae&&(M+=`&dec=${Ae}`);const B=await K.get(M,{headers:{Authorization:`Bearer ${F}`}});Z((ze=B==null?void 0:B.data)==null?void 0:ze.data),D(((Fe=B==null?void 0:B.data)==null?void 0:Fe.totalDocuments)||0),N(((qe=B==null?void 0:B.data)==null?void 0:qe.data)||[])}catch(M){console.error("Error fetching t list",M),u("Failed to fetch project")}finally{k(!1)}};t.useEffect(()=>{o()},[j,C,P,H,ae,w,G]);const $=a=>{m(a)},S=()=>{z(!1),_.success("Project added successfully!"),le(F),o()},Se=a=>{Y(a),m(1)},me=a=>{c(a),s(!0)},ue=a=>{y(!0),U(a)},ge=async()=>{const a={data:{branchcode:h.branchcode,project_code:h.project_code,delete_type:Q.delete_type,status:Q.status}};console.log("projectdeleteddataa",a);try{k(!0);const g=await K.delete(`${W}/project/overview/delete`,{data:a,headers:{Authorization:`Bearer ${F}`}});console.log("deleteemployeeresponse",g),(g==null?void 0:g.status)===201&&(y(!1),_.success("Project Deleted Successfully!"),o(),k(!1),oe({delete_type:"",status:""}))}catch(g){console.error("Error deleting branch",g),_.error("Failed to delete branch"),k(!1)}finally{k(!1)}},q=()=>{he(a=>a==="desc"?"":"desc"),m(1)},xe=a=>{R(a),m(1)},f=a=>{ee(a),m(1)},Ke=a=>{ne(a),m(1)},We=a=>{be(a),m(1)},De=a=>{const{name:g,value:pe}=a.target;oe(ye=>({...ye,[g]:pe}))},Xe=()=>[{data:"id"},{data:"Branch Code"},{data:"Project_Code"},{data:"Project Name"},{data:"Client_Code"},{data:"Payment Status"},{data:"Duration_Days"},{data:"Project Status"},{data:"Actions",className:"text-center"}],Ye=()=>v?v.map((a,g)=>({id:a.id,data:[{data:g+1},{data:a.branchcode},{data:a.project_code},{data:a.title},{data:a.client_code},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${a.paystatus==="request"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${a.paystatus==="request"?"bg-green-800":"bg-red-700"}`}),a.paystatus]})},{data:a.duration_days},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${a.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${a.status==="active"?"bg-green-800":"bg-red-700"}`}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})},{data:e.jsxs("div",{className:"flex  justify-center gap-2",children:[e.jsx(sa,{to:`/project/${a.project_code}`,children:e.jsx("button",{className:" px-4 py-2 dark:text-blue-600 text-blue-700 rounded-sm",children:e.jsx(Je,{className:"inline",size:20})})}),e.jsx("button",{className:"p-1 text-[var(--color-primary)] rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>me(a),title:"Pay Request",children:e.jsx(ia,{size:18})}),e.jsx("button",{className:"p-1 text-red-600 rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>ue(a),title:"Delete",children:e.jsx(ba,{size:18})})]}),className:"action-cell"}]})):[],Ze=()=>{s(!1),_.success("Branch updated successfully!"),le(F),o()},ea=()=>{re(!1),_.success("Meeting and Document Created successfully!")},aa=()=>{const a=J.book_new(),g=J.json_to_sheet(A);J.book_append_sheet(a,g,"Branches"),Ue(a,"ProjectList.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex -mb-px",children:ke.map(a=>e.jsx("button",{onClick:()=>je(a.id),className:`mr-8 py-4 px-1 border-b-2 font-medium text-sm ${I===a.id?"border-red-500 text-red-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a.label},a.id))})}),I==="projectlist"&&e.jsxs("div",{children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"Project List"}),i&&e.jsx("button",{onClick:()=>de(!te),className:"p-2 bg-gray-200 rounded-md",children:te?"Hide Filters":"Show Filters"})]}),e.jsx(Ge,{position:He,reverseOrder:!1}),e.jsx("div",{className:`flex ${i?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsxs("div",{className:`flex ${i?"flex-col":"flex-row"} gap-4`,children:[e.jsx(O,{options:r,selectedValue:G,onSelect:We,placeholder:"Items per page",className:"w-full md:w-[150px]"}),e.jsxs("button",{onClick:aa,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-3 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(Ve,{className:"mr-1"}),!i&&"Export Excel"]}),e.jsxs("button",{onClick:()=>z(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:[!i&&"New Project"," +"]})]})}),e.jsx("div",{className:`${i&&!te?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${i?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(O,{options:ce,selectedValue:P,onSelect:xe,placeholder:"Branch Status",className:"w-full md:w-[200px]"}),e.jsx(O,{options:L,selectedValue:ae,onSelect:Ke,placeholder:"Branch Code",className:"w-full md:w-[200px]",isLoading:ie}),e.jsx(O,{options:we,selectedValue:H,onSelect:f,placeholder:"Priority",className:"w-full md:w-[200px]",isLoading:ie}),e.jsxs("button",{onClick:q,className:`${i?"w-full":"w-[200px]"} h-[40px] text-white bg-[var(--color-primary)] hover-effect px-2 py-1 rounded-sm`,children:["Sort ",w==="desc"?"↑":"↓"]}),e.jsx("div",{className:`${i?"w-full":"w-[200px] mt-3"}`,children:e.jsx(Re,{value:C,onChange:Se,placeholder:"Search branches...",className:"w-full"})})]})}),b&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),p&&e.jsx("div",{className:"text-red-500 text-center py-4",children:p}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Le,{thead:Xe,tbody:Ye,responsive:!0,className:"min-w-full"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx(Oe,{total:l,currentPage:j,defaultPageSize:G,onChange:$,paginationLabel:"branches",isScroll:!0})})]}),I==="payrequest"&&e.jsx(ja,{})]}),e.jsx(se,{isVisible:T,className:"w-full md:w-[800px]",onClose:()=>z(!1),title:"Create New Project",children:e.jsx(da,{onSuccess:S,onCancel:()=>z(!1)})}),e.jsx(se,{isVisible:V,className:"w-full md:w-[800px]",onClose:()=>s(!1),title:"Edit Project",children:e.jsx(fa,{project:n,onSuccess:Ze,onCancel:()=>s(!1)})}),e.jsx(se,{isVisible:fe,className:"w-full md:w-[800px]",onClose:()=>re(!1),title:"Create Branch Meeting",children:e.jsx(la,{project:n,onSuccess:ea,onCancel:()=>re(!1)})}),e.jsx(se,{isVisible:d,className:"w-full md:w-[600px]",onClose:()=>y(!1),title:"Delete Project",children:e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(ya,{className:"inline mr-2"})," Delete Project"]}),e.jsx("p",{className:"text-gray-500 text-sm font-medium text-center",children:"Are you sure you want to delete this Project?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ha,{className:"inline mr-1",size:14})," Type"]}),e.jsxs("select",{name:"delete_type",value:Q.delete_type,onChange:De,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"temp",children:"Temporary"}),e.jsx("option",{value:"permanent",children:"Permanent"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Pe,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:Q.status,onChange:De,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"revised",children:"Revised"}),e.jsx("option",{value:"client_review",children:"Client_review"}),e.jsx("option",{value:"drop",children:"Drop"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>y(!1),disabled:b,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:ge,disabled:b,children:b?"Processing...":"Confirm"})]})]})})]})},St=ta(va);export{St as default};
