import{w as W}from"./with-props-DF0D9zIo.js";import{r as o,j as e}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{a as v,B as b}from"./api-C04JdqFc.js";import{O as P,V as g}from"./index-DxoBGdjx.js";import{M as z}from"./Modal-BCIUwH-b.js";import{B as E}from"./ButtonLoader-Z62NVHwI.js";import{u as X}from"./AuthStore-BnYeBJES.js";import{u as ee}from"./useBranchStore-kvv3vD_e.js";import{P as re}from"./plus-HifIQSWH.js";import{S as se}from"./square-pen-hueQTsQ_.js";import{T as ae}from"./trash-2-AUNIB88j.js";import{H as te}from"./hash-Cmnw3-GM.js";import{U as oe}from"./user-check-BVVInUPf.js";import{c as le}from"./createLucideIcon-RccWoOaL.js";import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./react-_sXfQCJm.js";/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],de=le("key",ne),De=W(function(){const[U,m]=o.useState(!1),[ie,he]=o.useState([]),[_,j]=o.useState(null),[I,T]=o.useState([]),[n,F]=o.useState(null),[x,k]=o.useState(null),[h,N]=o.useState(null),[c,w]=o.useState({branchcode:"",role:""}),[$,D]=o.useState({branchid:"",roleid:"",notes:"",userId:"GK123"}),[q,y]=o.useState(!1),[d,i]=o.useState(!1),p=X(r=>r.accessToken),C=ee(r=>r.branchCodeOptions),[ue,ge]=o.useState([]),[S,A]=o.useState([]),f=async()=>{try{const r=await v.get(`${b}/setting/read`,{headers:{Authorization:`Bearer ${p}`}});console.log("userole responsee",r==null?void 0:r.data),T(r==null?void 0:r.data)}catch(r){console.log("error in fetch user role",r)}};o.useEffect(()=>{f()},[]);const R=r=>{const{name:s,value:a}=r.target;w(t=>({...t,[s]:a}))},L=async r=>{const s=r.target.value;if(w(a=>({...a,branchcode:s,role:""})),s)try{i(!0);const u=(await(await fetch(`${b}/branch/dropdown?branchcode=${s}`,{headers:{Authorization:`Bearer ${p}`}})).json()).result.map(l=>({value:l.role,label:l.role}));A(u)}catch(a){console.error("Error fetching roles:",a),A([])}finally{i(!1)}else A([])},M=r=>{const{name:s,value:a}=r.target;D(t=>({...t,[s]:a}))},O=async r=>{var s,a,t,u;j(null),r.preventDefault();try{i(!0),console.log("addroledata",c);const l=`${b}/setting/create`;(await v.post(l,c,{headers:{Authorization:`Bearer ${p}`}})).status==201&&(m(!1),g.success("Add Role Successfully!",{style:{border:"1px solid #2b6cb0",padding:"14px",width:"900px",color:"#2b6cb0"},iconTheme:{primary:"#2b6cb0",secondary:"#FFFAEE"}})),i(!1),f(),w({branchId:"",role:"",userId:""})}catch(l){console.log("error in Add role",(a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.error),j((u=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:u.error),m(!0),g.error(`${_} Error in add role`,{style:{border:"1px solid  rgb(185 28 28)",padding:"14px",width:"900px",color:" rgb(185 28 28)"},iconTheme:{primary:" rgb(185 28 28)",secondary:"#FFFAEE"}}),j(null),i(!1)}},V=r=>{F(r);const{id:s,branch_id:a,role:t,create_datetime:u,last_update_datetime:l,...B}=r;console.log("errorrsetdeletee",s,a),k(B)},H=(r,s,a)=>{k(t=>({...t,[r]:{...t[r],[s]:a}}))},Z=async()=>{var r,s;if(!n){g.error("Please select a role and enter User ID");return}try{i(!0);const a=`${b}/setting/edit/${n.id}`,t={branchcode:n.branchcode.toString(),data:x,userId:c.userId};console.log("Sending payload:",t),(await v.put(a,t,{headers:{Authorization:`Bearer ${p}`}})).status===200&&(g.success("Access permission updated Successfully!",{style:{border:"1px solid #2b6cb0",padding:"14px",width:"900px",color:"#2b6cb0"},iconTheme:{primary:"#2b6cb0",secondary:"#FFFAEE"}}),f())}catch(a){console.log("Error updating permissions:",a),g.error(((s=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:s.error)||"Error in add role",{style:{border:"1px solid  rgb(185 28 28)",padding:"14px",width:"900px",color:" rgb(185 28 28)"},iconTheme:{primary:" rgb(185 28 28)",secondary:"#FFFAEE"}})}finally{i(!1)}},K=r=>!x||!x[r]?null:e.jsx("div",{className:"flex flex-col gap-4 pl-9",children:Object.entries(x[r]).map(([s,a])=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:t=>H(r,s,t.target.checked),className:`h-4 w-4 rounded border-gray-300 dark:border-gray-600 \r
                bg-white dark:bg-gray-700\r
                checked:bg-red-700 dark:checked:bg-red-600\r
                focus:ring-red-700 dark:focus:ring-red-600\r
                text-red-700 dark:text-red-600\r
                transition-colors`}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:s==="all"?`All ${r.replace(/([A-Z])/g," $1").toLowerCase()}`:`${s.charAt(0).toUpperCase()+s.slice(1)} ${r.replace(/([A-Z])/g," $1").toLowerCase()}`})]},s))}),G=()=>x?Object.keys(x).filter(s=>!["id","branchcode","role","create_datetime","last_update_datetime"].includes(s)).map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(de,{className:"text-gray-600 dark:text-gray-400",size:20}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[s.replace(/([A-Z])/g," $1")," Permissions:"]})]}),K(s)]},s)):null,Y=r=>{console.log("deleterolited",r),N(r),y(!0)},J=async()=>{var s,a;if(!h)return;const r={branchcode:h.branchcode.toString(),notes:$.notes};console.log("deletepayload",r);try{i(!0);const t=`${b}/setting/delete/${h.id}`;console.log("deleteurlll",t),(await v.delete(t,{data:r,headers:{Authorization:`Bearer ${p}`}})).status===200&&(g.success("User Role Deleted Successfully!",{style:{border:"1px solid #2b6cb0",padding:"14px",width:"900px",color:"#2b6cb0"},iconTheme:{primary:"#2b6cb0",secondary:"#FFFAEE"}}),f(),N(null),D([]),(n==null?void 0:n.id)===h.id&&(F(null),k(null)))}catch(t){console.log("Error deleting role:",t),g.error(((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.error)||"Error in deleting role",{style:{border:"1px solid  rgb(185 28 28)",padding:"14px",width:"900px",color:" rgb(185 28 28)"},iconTheme:{primary:" rgb(185 28 28)",secondary:"#FFFAEE"}})}finally{i(!1),y(!1),N(null)}},Q=()=>e.jsx(z,{isVisible:q,onClose:()=>y(!1),title:"Confirm Delete",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:['Are you sure you want to delete the role "',h==null?void 0:h.role,'"?']}),e.jsxs("div",{className:"flex flex-col py-2 text-left mt-4",children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:"Notes (required for deletion)"}),e.jsx("input",{name:"notes",value:$.notes,onChange:M,className:"w-full bg-blue-200/25 dark:bg-gray-700 text-sm px-3 py-2 border border-gray-400 dark:border-gray-600 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-600 focus:border-gray-400 dark:focus:border-gray-500 rounded",type:"text",placeholder:"Enter Your Notes Here",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 bg-[var(--color-secondary)] hover:[var(--color-hover-secondary)] hover-effect text-gray-800 dark:text-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-500 transition",disabled:d,children:"Cancel"}),e.jsx("button",{type:"button",onClick:J,className:"px-4 py-2 bg-[var(--color-primary)] hover:bg-[var(--color-hover)] text-white rounded hover:bg-gradient-to-b hover-effect transition",disabled:d,children:d?e.jsx(E,{}):"Delete Role"})]})]})});return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-8",children:[e.jsx(P,{position:"top-center",reverseOrder:!1}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 w-full lg:w-[50%]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-600 dark:text-gray-300",children:"Role"}),e.jsxs("button",{className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-600 flex items-center gap-1",onClick:()=>m(!0),children:[e.jsx(re,{className:"inline",size:20}),e.jsx("span",{children:"Add Role"})]})]}),e.jsx("div",{className:"flex flex-col gap-1 mt-4",children:e.jsx("ul",{children:I.map(r=>e.jsxs("li",{className:"flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-700 py-3 px-3 transition-colors",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:r.role.charAt(0).toUpperCase()+r.role.slice(1).toLowerCase()}),e.jsxs("div",{className:"flex space-x-4 text-gray-600 dark:text-gray-400",children:[e.jsx("button",{onClick:()=>V(r),children:e.jsx(se,{className:"inline hover:text-red-600 dark:hover:text-red-400 cursor-pointer",size:20})}),e.jsx(ae,{className:"inline hover:text-red-600 dark:hover:text-red-400 cursor-pointer",onClick:()=>Y(r),size:20})]})]},r.id))})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 w-full lg:w-[50%]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-lg font-bold text-gray-600 dark:text-gray-300",children:["Permissions: ",(n==null?void 0:n.role)||"Select a role"]}),n&&e.jsx("button",{onClick:Z,className:"px-3 py-1 bg-[var(--color-primary)] text-sm hover:bg-[var(--color-hover)] text-white rounded hover:bg-gradient-to-b hover-effect transition",disabled:d,children:d?e.jsx(E,{}):"Save Permissions"})]}),n?e.jsxs("div",{className:"flex flex-col gap-6 mt-4",children:[G(),e.jsxs("div",{className:"flex flex-col py-2 text-left",children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:"User ID (required for update)"}),e.jsx("input",{name:"userId",value:c.userId,onChange:R,className:"w-full bg-blue-200/25 dark:bg-gray-700 text-sm px-3 py-2 border border-gray-400 dark:border-gray-600 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-600 focus:border-gray-400 dark:focus:border-gray-500 rounded",type:"text",placeholder:"Enter user ID",required:!0})]})]}):e.jsx("div",{className:"mt-4 text-gray-500 dark:text-gray-400",children:"Please select a role to view and edit permissions"})]})]}),e.jsxs(z,{isVisible:U,onClose:()=>m(!1),title:"Add Role Form",children:[e.jsx(P,{position:"top-center",reverseOrder:!1}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(te,{className:"inline mr-1",size:14})," Branch Code"]}),e.jsxs("select",{name:"branchcode",value:c.branchcode,onChange:L,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:d,children:[e.jsx("option",{value:"",children:"Select Branch"}),C==null?void 0:C.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(oe,{className:"inline mr-1",size:14})," User Role"]}),e.jsxs("select",{name:"role",value:c.role,onChange:R,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!c.branchcode||d,children:[e.jsx("option",{value:"",children:"Select Role"}),S==null?void 0:S.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 bg-[var(--color-secondary)] hover:[var(--color-hover-secondary)] hover-effect text-gray-800 dark:text-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-500 transition",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-[var(--color-primary)] hover:bg-[var(--color-hover)] text-white rounded hover:bg-gradient-to-b hover-effect transition",disabled:d||!c.branchcode||!c.role,onClick:O,children:d?e.jsx(E,{}):"Create Role"})]})]}),Q()]})});export{De as default};
