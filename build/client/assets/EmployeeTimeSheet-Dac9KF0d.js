import{w as ge}from"./with-props-DF0D9zIo.js";import{r,j as t}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as Se}from"./DataTable-DtyPIAGZ.js";import{C as be}from"./CustomPagination-CBTcVvJz.js";import{D as N}from"./DrapDown-CEm3nLdF.js";import{F as je,u as k,w as ye}from"./xlsx-DTxMWUdD.js";import{t as ve,B as C,a as $}from"./api-C04JdqFc.js";import{O as we,V as y}from"./index-DxoBGdjx.js";import{u as v}from"./AuthStore-BnYeBJES.js";import{u as Ne}from"./useBranchStore-kvv3vD_e.js";import{u as ke}from"./use-click-outside-BhLpsQYS.js";/* empty css                         */import{A as Ce,a as $e}from"./arrow-up-narrow-wide-BXfcg2ON.js";import{S as G}from"./square-kanban-CCTPh8t8.js";import{H as Ee}from"./hourglass-BDGbSW0U.js";import"./index-knF4tUPh.js";/* empty css            */import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";const Te=()=>{var V;const q=ke({query:"(max-width: 768px)"}),[H,S]=r.useState(1),[x,p]=r.useState(!1),[W,K]=r.useState(0),[E,Q]=r.useState(null),[c,T]=r.useState(""),[f,w]=r.useState(""),[_e,Y]=r.useState(""),[g,_]=r.useState(""),[D,J]=r.useState(10),[b,De]=r.useState(null),[n,P]=r.useState(null),[O,Pe]=r.useState(null),[B,Oe]=r.useState(null),[X,R]=r.useState([]),[Be,I]=r.useState([]),[L,Re]=r.useState("checkinout"),[j,Z]=r.useState(""),m=v(e=>e.accessToken),ee=v(e=>e.permissions),h=v(e=>e.staff_id),l=v(e=>e.branchcode),[te,z]=r.useState(0),a=((V=ee[0])==null?void 0:V.role)||"employee";console.log("roleeeeee",a,l,h),console.log("User role and details:",{role:a,staff_id:h,userBranchCode:l});const{branchCodeOptions:F,fetchBranches:ae,isLoading:se}=Ne(),re=[{value:10,label:"10 per page"},{value:20,label:"20 per page"},{value:50,label:"50 per page"},{value:100,label:"100 per page"}],oe=()=>a==="superadmin"?F:a==="team-lead"?F.filter(e=>e.value===l):[];r.useEffect(()=>{(a==="superadmin"||a==="team-lead")&&ae(m)},[m,a]),r.useEffect(()=>{a==="team-lead"&&T(l)},[a,l]),r.useEffect(()=>{a!=="team-lead"&&a!=="superadmin"&&w(h)},[a,h]),r.useEffect(()=>{(a==="superadmin"||a==="team-lead")&&(async()=>{if(a==="superadmin"&&!c||a==="team-lead"&&!l){R([]);return}p(!0);try{const o=`${C}/users/read?branchcode=${a==="team-lead"?l:c}`,i=await $.get(o,{headers:{Authorization:`Bearer ${m}`}});if(i.data&&i.data.data){const d=i.data.data.map(u=>({value:u.staff_id,label:`${u.firstname} ${u.lastname} (${u.staff_id})`}));R(d)}}catch(s){console.error("Error fetching staff list",s),y.error("Failed to fetch staff")}finally{p(!1)}})()},[c,m,a,l]),r.useEffect(()=>{(a==="superadmin"||a==="team-lead")&&(async()=>{if(a==="superadmin"&&!c||a==="team-lead"&&!l){I([]);return}p(!0);try{const o=`${C}/project/overview/dropdown?branchcode=${a==="team-lead"?l:c}`,i=await $.get(o,{headers:{Authorization:`Bearer ${m}`}});if(i.data&&i.data.data){const d=i.data.data.map(u=>({value:u.project_code,label:u.title}));I(d)}}catch(s){console.error("Error fetching project list",s),y.error("Failed to fetch projects")}finally{p(!1)}})()},[c,m,a,l]);const A=async()=>{var s;const e=a!=="team-lead"&&a!=="superadmin"?h:f;if(!e){P(null);return}p(!0);try{let o=`${C}/project/task/checkinout/read?staff_id=${encodeURIComponent(e)}`;if(g&&(o+=`&task_id=${g}`),O){const d=U(O);o+=`&start_date=${d}`}if(B){const d=U(B);o+=`&end_date=${d}`}j&&(o+=`&dec=${j}`);const i=await $.get(o,{headers:{Authorization:`Bearer ${m}`}});i.data&&(P(i.data),K(((s=i.data.data)==null?void 0:s.length)||0))}catch(o){console.error("Error fetching check-in/out data",o),y.error("Failed to fetch check-in/out data"),Q("Failed to fetch data")}finally{p(!1)}},U=e=>{if(!e)return"";const s=new Date(e),o=s.getFullYear().toString().slice(-2),i=(s.getMonth()+1).toString().padStart(2,"0"),d=s.getDate().toString().padStart(2,"0");return`${o}-${i}-${d}`},ne=e=>{S(e)},ie=e=>{T(e),w(""),Y(""),_(""),S(1)},le=e=>{w(e),S(1)},de=e=>{_(e.target.value)},ce=e=>{J(e),S(1)},me=()=>{Z(e=>e==="desc"?"":"desc")},ue=()=>{var d;let e=[],s="";if(L==="timesheetreport"&&((d=b==null?void 0:b.data)!=null&&d.summary)?(e=b.data.summary,s="TimeSheetReport"):L==="checkinout"&&(n!=null&&n.data)&&(e=n.data,s="CheckInOutReport"),e.length===0){y.error("No data to export");return}const o=k.book_new(),i=k.json_to_sheet(e);k.book_append_sheet(o,i,s),ye(o,`${s}.xlsx`)},pe=()=>{A()};r.useEffect(()=>{a!=="superadmin"&&a!=="team-lead"&&A()},[]);const fe=()=>[{data:"Id"},{data:"Task ID"},{data:"Project"},{data:"Task"},{data:"Subtask"},{data:"Check-in"},{data:"Check-out"},{data:"Duration (mins)"},{data:"Staff"}],he=()=>n!=null&&n.data?n.data.map((e,s)=>({id:e.id||s,data:[{data:s+1},{data:e.task_id},{data:e.project_title},{data:e.task_title},{data:e.subtask_title},{data:new Date(e.check_in).toLocaleString()},{data:e.check_out?new Date(e.check_out).toLocaleString():"Still checked in"},{data:e.duration},{data:e.staff_name}]})):[],M=()=>n?n.data.reduce((e,s)=>{const o=typeof s.duration=="string"?parseFloat(s.duration):s.duration;return e+(o||0)},0):0;r.useEffect(()=>{n!=null&&n.data?z(M()):z(0)},[n]),console.log("calculatetotallldura",M());const xe=e=>{if(isNaN(e))return"0 minutes";const s=Math.floor(e/60),o=Math.round(e%60);return s>0&&o>0?`${s} hour${s!==1?"s":""} ${o} minute${o!==1?"s":""}`:s>0?`${s} hour${s!==1?"s":""}`:`${o} minute${o!==1?"s":""}`};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"flex flex-col min-h-screen",children:t.jsxs("div",{className:"p-4 flex-grow",children:[t.jsx("div",{className:"flex justify-between items-center mb-4",children:t.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)] mb-5",children:"Employee Check In - Check Out"})}),t.jsx(we,{position:ve,reverseOrder:!1}),t.jsxs("div",{className:"flex flex-col gap-4 mb-5",children:[t.jsxs("div",{className:`grid grid-cols-1${a!=="superadmin"&&a!=="team-lead"?"md:grid-cols-2 lg:grid-cols-2 gap-3":" md:grid-cols-4 lg:grid-cols-4 gap-20"}  `,children:[(a==="superadmin"||a==="team-lead")&&t.jsx(N,{options:oe(),selectedValue:c,onSelect:ie,placeholder:"Select Branch",className:"w-[245px]",isLoading:se,disabled:a==="team-lead"}),(a==="superadmin"||a==="team-lead")&&t.jsx(N,{options:X,selectedValue:f,onSelect:le,placeholder:"Select Staff",className:"w-[245px]",disabled:a==="team-lead"?!l:!c,isLoading:x}),t.jsx("div",{className:"w-[245px]",children:t.jsx("input",{type:"number",value:g,onChange:de,placeholder:"Enter Task ID (optional)",className:"w-full p-2 border rounded h-[40px]"})}),t.jsx(N,{options:re,selectedValue:D,onSelect:ce,placeholder:"Items per page",className:"w-[245px]"})]}),t.jsxs("div",{className:"flex flex-wrap justify-between items-center ",children:[t.jsxs("div",{className:`flex  ${a!=="superadmin"&&a!=="team-lead"?"gap-91":"gap-19"}`,children:[t.jsxs("button",{onClick:me,className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect px-18 h-[40px] rounded-sm",children:[j==="desc"?t.jsx(Ce,{className:"mr-1"}):t.jsx($e,{className:"mr-1"}),"Sort ",j==="desc"?"Desc":"Asc"]}),t.jsxs("button",{onClick:ue,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-2 dark:bg-gray-800 dark:text-gray-300 py-2 w-[245px]",disabled:!(n!=null&&n.data),children:[t.jsx(je,{className:"mr-1"}),!q&&"Export Excel"]})]}),t.jsx("button",{onClick:pe,className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",disabled:(a!=="team-lead"&&a!=="superadmin"?!1:!f)||x,children:x?"Loading...":"Generate Report"})]})]}),n&&t.jsxs("div",{className:"mb-6 p-4 bg-gray-200 dark:bg-gray-800 rounded-lg",children:[t.jsx("h3",{className:"text-lg text-red-700 font-semibold mb-2",children:"Report Summary"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[t.jsx(G,{className:"inline",size:20})," Staff ID"]}),t.jsx("p",{className:"font-medium",children:a!=="team-lead"&&a!=="superadmin"?h:f})]}),g&&t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[t.jsx(G,{className:"inline",size:20})," Task ID"]}),t.jsx("p",{className:"font-medium",children:g})]}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:[t.jsx(Ee,{className:"inline",size:20})," Duration Range"]}),t.jsx("p",{className:"font-medium",children:xe(te)})]})]})]}),x&&t.jsx("div",{className:"text-center py-4",children:"Loading..."}),E&&t.jsx("div",{className:"text-red-500 text-center py-4",children:E}),(n==null?void 0:n.data)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsx(Se,{thead:fe,tbody:he,responsive:!0,className:"min-w-full"})}),t.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:t.jsx(be,{total:W,currentPage:H,defaultPageSize:D,onChange:ne,paginationLabel:"records",isScroll:!0})})]}),!x&&!n&&t.jsx("div",{className:"text-center py-10 text-gray-500",children:a!=="team-lead"&&a!=="superadmin"?"Click 'Generate Report' to view your check-in/out data":a==="team-lead"?l?f?"Click 'Generate Report' to view data":"Please select Staff to view check-in/out data":"Loading branch information...":c?f?"Click 'Generate Report' to view data":"Please select Staff to view check-in/out data":"Please select Branch to view available options"})]})})})},tt=ge(Te);export{tt as default};
