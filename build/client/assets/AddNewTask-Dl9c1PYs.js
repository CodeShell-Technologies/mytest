import{r as i,j as e}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{a as x,B as p}from"./api-C04JdqFc.js";import{V as m}from"./index-DxoBGdjx.js";import{B as K}from"./ButtonLoader-Z62NVHwI.js";import{u as C}from"./AuthStore-BnYeBJES.js";import{u as Q}from"./useBranchStore-kvv3vD_e.js";import{F as W}from"./flag-GJ94Fqe2.js";import{H as X}from"./hash-Cmnw3-GM.js";import{N as Y}from"./network-4iL8t-Of.js";import{M as Z,T as ee}from"./EditTaskForm-Cwdu_Gp4.js";import{U as re}from"./users-CXAhoVGa.js";import{C as A}from"./clipboard-list-C2ET-QCv.js";import{T}from"./tag-hjf6KM-t.js";import{C as $}from"./calendar-check-DuYbAMAv.js";import{U as D}from"./user-DKFoNGWn.js";import{T as ae}from"./trash-2-AUNIB88j.js";import{P as te}from"./plus-HifIQSWH.js";import{L as se}from"./list-checks-Bum2w6xD.js";const Ne=({onSuccess:M,onCancel:F})=>{const[S,h]=i.useState(!1),[z,d]=i.useState(null),[y,q]=i.useState([]),[f,k]=i.useState([]),[j,B]=i.useState([]),[v,_]=i.useState([]),P=C(a=>a.permissions)[0].role,L=Q(a=>a.branchCodeOptions),E=C(a=>a.branchcode),u=C(a=>a.accessToken),N=P==="superadmin"?L:[{value:E,label:E}],[r,c]=i.useState({branchcode:"",project_code:"",milestone_code:"",task_title:"",task_priority:"",start_date:"",end_date:"",team_id:"",handler_by:"",notes:"",collaborate:[{subtask_title:"",staff_id:"",status:"open"}],status:"draft"});i.useEffect(()=>{r.branchcode?(R(r.branchcode),U(r.branchcode)):(q([]),k([]),B([]),_([]))},[r.branchcode]),i.useEffect(()=>{r.project_code?H(r.project_code):_([])},[r.project_code]),i.useEffect(()=>{r.team_id?I(r.team_id):k([])},[r.team_id]);const R=async a=>{try{const t=await x.get(`${p}/teams/read?branchcode=${a}`,{headers:{Authorization:`Bearer ${u}`}});if(t.data&&t.data.data){const s=t.data.data.map(o=>({value:o.team_id,label:o.team_name,team_lead:o.team_lead}));q(s)}}catch(t){console.error("Error fetching teams:",t),m.error("Failed to load teams")}},U=async a=>{try{const t=await x.get(`${p}/project/overview/dropdown?branchcode=${a}`,{headers:{Authorization:`Bearer ${u}`}});if(t.data&&t.data.data){const s=t.data.data.map(o=>({value:o.project_code,label:o.title}));B(s)}}catch(t){console.error("Error fetching projects:",t),m.error("Failed to load projects")}},H=async a=>{try{const t=await x.get(`${p}/project/milestone/dropdown?project_code=${a}`,{headers:{Authorization:`Bearer ${u}`}});if(t.data&&t.data.data){const s=t.data.data.map(o=>({value:o.milestone_code,label:o.miles_title}));_(s)}}catch(t){console.error("Error fetching milestones:",t),m.error("Failed to load milestones")}},I=async a=>{try{const t=await x.get(`${p}/teams/read/profile?team_id=${a}`,{headers:{Authorization:`Bearer ${u}`}});if(t.data&&t.data.data){const s=t.data.data.members.filter(n=>n.role!=="lead");k(s);const o=t.data.data.members.find(n=>n.role==="lead");o&&c(n=>({...n,handler_by:o.staff_id}))}}catch(t){console.error("Error fetching team members:",t),m.error("Failed to load team members")}},l=a=>{const{name:t,value:s}=a.target;c(t==="branchcode"?o=>({...o,[t]:s,project_code:"",milestone_code:""}):t==="project_code"?o=>({...o,[t]:s,milestone_code:""}):o=>({...o,[t]:s}))},w=(a,t)=>{const{name:s,value:o}=t.target,n=[...r.collaborate];n[a]={...n[a],[s]:o},c(b=>({...b,collaborate:n}))},V=()=>{c(a=>({...a,collaborate:[...a.collaborate,{subtask_title:"",staff_id:"",status:"open"}]}))},O=a=>{if(r.collaborate.length===1)return;const t=r.collaborate.filter((s,o)=>o!==a);c(s=>({...s,collaborate:t}))},G=()=>{if(!r.branchcode)return d("Branch code is required"),!1;if(!r.project_code)return d("Project is required"),!1;if(!r.milestone_code)return d("Milestone is required"),!1;if(!r.task_title)return d("Task title is required"),!1;if(!r.start_date||!r.end_date)return d("Both start and end dates are required"),!1;if(new Date(r.start_date)>new Date(r.end_date))return d("End date must be after start date"),!1;if(!r.team_id)return d("Team is required"),!1;if(!r.handler_by)return d("Handler is required"),!1;for(const a of r.collaborate)if(!a.staff_id)return d("All collaborators must have a staff selected"),!1;return!0},J=async a=>{var s,o,n,b;if(a.preventDefault(),h(!0),d(null),!G()){h(!1);return}const t={data:[{branchcode:r.branchcode,project_code:r.project_code,milestone_code:r.milestone_code,task_title:r.task_title,task_priority:r.task_priority,start_date:r.start_date,end_date:r.end_date,handler_by:r.handler_by,team_id:r.team_id,notes:r.notes,collaborate:r.collaborate,status:r.status}]};try{const g=await x.post(`${p}/project/task/create`,t,{headers:{Authorization:`Bearer ${u}`}});g.status===201?(m.success("Task created successfully!"),M()):d(g.data.message||"Failed to create task")}catch(g){d(((o=(s=g.response)==null?void 0:s.data)==null?void 0:o.message)||"An error occurred"),m.error(((b=(n=g.response)==null?void 0:n.data)==null?void 0:b.message)||"Error creating task")}finally{h(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[z&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:z}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(W,{className:"inline mr-2"})," Task Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(X,{className:"inline mr-1",size:14})," Branch Code"]}),e.jsxs("select",{name:"branchcode",value:r.branchcode,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),N==null?void 0:N.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Y,{className:"inline mr-1",size:14})," Select Project"]}),e.jsxs("select",{name:"project_code",value:r.project_code,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!r.branchcode,children:[e.jsx("option",{value:"",children:"Select Project"}),j==null?void 0:j.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Z,{className:"inline mr-1",size:14})," Select Milestone"]}),e.jsxs("select",{name:"milestone_code",value:r.milestone_code,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!r.project_code,children:[e.jsx("option",{value:"",children:"Select Milestone"}),v==null?void 0:v.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Select Team"]}),e.jsxs("select",{name:"team_id",value:r.team_id,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!r.branchcode,children:[e.jsx("option",{value:"",children:"Select Team"}),y==null?void 0:y.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(A,{className:"inline mr-1",size:14})," Task Title"]}),e.jsx("input",{name:"task_title",value:r.task_title,onChange:l,type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter task name",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(T,{className:"inline mr-1",size:14})," Task Priority"]}),e.jsxs("select",{name:"task_priority",value:r.task_priority,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Priority"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"blocker",children:"Blocker"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx($,{className:"inline mr-1",size:14})," Start Date"]}),e.jsx("input",{name:"start_date",value:r.start_date,onChange:l,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx($,{className:"inline mr-1",size:14})," Due Date"]}),e.jsx("input",{name:"end_date",value:r.end_date,onChange:l,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(D,{className:"inline mr-1",size:14})," Handle By (Team Lead)"]}),e.jsx("input",{name:"handler_by",value:r.handler_by,readOnly:!0,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none cursor-not-allowed"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(T,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:r.status,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"inprocess",children:"In Progress"}),e.jsx("option",{value:"verified-closed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"}),e.jsx("option",{value:"rework",children:"Rework"}),e.jsx("option",{value:"drop",children:"Drop"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Collaborators"}),r.collaborate.map((a,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 relative",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(A,{className:"inline mr-1",size:14})," Sub Task Title"]}),e.jsx("input",{name:"subtask_title",value:a.subtask_title,onChange:s=>w(t,s),type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter Subtask Title",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(D,{className:"inline mr-1",size:14})," Team Member"]}),e.jsxs("select",{name:"staff_id",value:a.staff_id,onChange:s=>w(t,s),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!r.team_id,children:[e.jsx("option",{value:"",children:"Select Team Member"}),f==null?void 0:f.map(s=>e.jsxs("option",{value:s.staff_id,children:[s.staff_name," (",s.department,")"]},s.staff_id))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(T,{className:"inline mr-1",size:14})," Collaboration Status"]}),e.jsxs("select",{name:"status",value:a.status,onChange:s=>w(t,s),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"inprocess",children:"In Progress"}),e.jsx("option",{value:"verified-closed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"}),e.jsx("option",{value:"rework",children:"Rework"}),e.jsx("option",{value:"drop",children:"Drop"})]})]}),t>0&&e.jsx("button",{type:"button",onClick:()=>O(t),className:"absolute -right-2 -top-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(ae,{size:16})})]},t)),e.jsxs("button",{type:"button",onClick:V,className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",disabled:!r.team_id,children:[e.jsx(te,{size:16})," Add Another Collaborator"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(se,{className:"inline mr-2"})," Notes"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(ee,{className:"inline mr-1",size:14})," Task Notes"]}),e.jsx("textarea",{name:"notes",value:r.notes,onChange:l,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[100px]",placeholder:"Enter the Task Notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:F,children:"Cancel"}),e.jsx("button",{type:"submit",onClick:J,disabled:S,className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-800 dark:hover:bg-red-900 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm disabled:opacity-70",children:S?e.jsx(K,{}):"Create Task"})]})]})};export{Ne as A};
