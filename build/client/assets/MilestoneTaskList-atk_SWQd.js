import{w as lt}from"./with-props-DF0D9zIo.js";import{r as n,j as e,u as ot,c as dt,b as it}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as ct}from"./DataTable-DtyPIAGZ.js";import{C as mt}from"./CustomPagination-CBTcVvJz.js";import{S as ut}from"./SearchInput-CMdOUuSO.js";import{M as ie}from"./Modal-BCIUwH-b.js";import{D as pe}from"./DrapDown-CEm3nLdF.js";import{F as xt,u as he,w as gt}from"./xlsx-DTxMWUdD.js";import{a as T,B as z,t as $e}from"./api-C04JdqFc.js";import{V as v,O as Ee}from"./index-DxoBGdjx.js";import{u as Q}from"./AuthStore-BnYeBJES.js";import{u as ye}from"./useBranchStore-kvv3vD_e.js";import{u as pt}from"./use-click-outside-BhLpsQYS.js";import{a as ht}from"./ProjectStore-Bmk5yusB.js";import"./LeadsStore-C-d0npQs.js";import{K as ft,N as yt}from"./useEmployeeStore-BJ_SZO4g.js";import{M as bt,T as jt,E as kt}from"./EditTaskForm-Cwdu_Gp4.js";import{B as Pe}from"./ButtonLoader-Z62NVHwI.js";import{V as vt,F as Se,L as Nt,M as wt,C as _t}from"./video-BzePKQuD.js";import{F as Te}from"./file-text-BNGbNc3I.js";import{C as re}from"./clipboard-list-C2ET-QCv.js";import{F as Ct}from"./file-QxKA-9Fo.js";import{C as St}from"./calendar-C_LRGMui.js";import{C as Tt}from"./clock-CzOQJT5p.js";import{U as ce}from"./users-CXAhoVGa.js";import{X as fe}from"./x-BfrbTbzo.js";import{C as ze}from"./chevron-up-DjUqBI0v.js";import{C as De}from"./chevron-down-DOBgonSl.js";import{P as Le}from"./plus-HifIQSWH.js";import{f as Me}from"./dateUtils-CBplQNBw.js";import{F as zt}from"./flag-GJ94Fqe2.js";import{H as Dt}from"./hash-Cmnw3-GM.js";import{T as me}from"./tag-hjf6KM-t.js";import{C as Ae}from"./calendar-check-DuYbAMAv.js";import{U as Be}from"./user-DKFoNGWn.js";import{T as Ie}from"./trash-2-AUNIB88j.js";import{L as Mt}from"./list-checks-Bum2w6xD.js";import{L as At}from"./log-out-DAuSHV9-.js";import{N as Fe}from"./network-4iL8t-Of.js";import{M as Bt}from"./message-square-text-D3my64cM.js";import{C as Ft}from"./clipboard-check-ZUIfxiNP.js";import{C as $t}from"./clipboard-type-fPi_05HQ.js";import{E as Et}from"./eye-2Mk8PZw-.js";import{S as Pt}from"./square-pen-hueQTsQ_.js";import"./index-knF4tUPh.js";/* empty css            */import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";/* empty css                         */import"./moment-C5S46NFB.js";import"./user-round-DtkRnRSi.js";const Lt=({milestone:g,onSuccess:B,onCancel:J})=>{console.log("projectcodeee",g);const[C,N]=n.useState(!1),[X,x]=n.useState(null),[j,V]=n.useState([]),[k,D]=n.useState([]),[ee,te]=n.useState([]),[O,M]=n.useState([]),[H,F]=n.useState([]),[$,o]=n.useState(!1),[A,U]=n.useState(!1),S=Q(t=>t.accessToken);Q(t=>t.permissions)[0].role,ye(t=>t.branchCodeOptions),Q(t=>t.branchcode);const[y,K]=n.useState([{type:"",branchcode:"",teamId:"",staffType:"staff"}]),[l,E]=n.useState({branchcode:g.branchcode,milestone_code:g.milestone_code,title:"",notes:"",comm_type:"meeting",status:"active",doc_status:"none",meet_link:"",start_date_time:"2025-02-01T00:00:00Z,",end_date_time:"2025-02-01T23:59:59Z",category:"branch",field:"custom",doc:[],custom:[],communication_participants:[]});n.useEffect(()=>{(async()=>{try{const r=await T.get(`${z}/branch/dropdown`,{headers:{Authorization:`Bearer ${S}`}});te(r.data.result)}catch(r){console.error("Error fetching initial data:",r),v.error("Failed to load initial data")}})()},[S]),n.useEffect(()=>{const t=[...new Set(y.filter(s=>s.type==="team"&&s.branchcode).map(s=>s.branchcode))],r=async()=>{try{const s=t.map(async h=>(await T.get(`${z}/teams/read?branchcode=${h}`,{headers:{Authorization:`Bearer ${S}`}})).data.data),i=await Promise.all(s);M(i.flat())}catch(s){console.error("Error fetching teams:",s),v.error("Failed to load teams")}};t.length>0&&r()},[y,S]),n.useEffect(()=>{l.category==="custom"?u():l.category==="branch"&&l.branchcode?se():l.category==="team"&&d()},[l.category,l.branchcode,y]);const se=async()=>{try{const t=await T.post(`${z}/users/filter`,{branch:[l.branchcode],team:[],type:["staff","client"]},{headers:{Authorization:`Bearer ${S}`}});F([...t.data.staff,...t.data.client])}catch(t){console.error("Error fetching branch participants:",t),v.error("Failed to fetch participants")}},d=async()=>{try{const t=await T.post(`${z}/users/filter`,{branch:[l.branchcode],team:[],type:["staff","client"]},{headers:{Authorization:`Bearer ${S}`}});F([...t.data.staff,...t.data.client])}catch(t){console.error("Error fetching branch participants:",t),v.error("Failed to fetch participants")}},u=async()=>{try{const t=y.filter(c=>c.type==="branch"&&c.branchcode).map(c=>c.branchcode),r=y.filter(c=>c.type==="team"&&c.teamId&&c.branchcode).map(c=>{const q=c.teamId.split("/"),Y=q[q.length-1];return`${c.branchcode}/TEAM/${Y}`}),s=y.filter(c=>c.type==="team"&&c.branchcode).map(c=>c.branchcode),i=[...new Set([...t,...s])],h=[];y.forEach(c=>{(c.type==="branch"||c.type==="team")&&(c.staffType==="staff"&&h.push("staff"),c.staffType==="client"&&h.push("client"),c.staffType==="both"&&(h.push("staff"),h.push("client")))});const p=[...new Set(h)];if(console.log("Sending filter request with:",{branch:i,team:r,type:p.length>0?p:["staff","client"]}),i.length>0||r.length>0){const c=await T.post(`${z}/users/filter`,{branch:i,team:r,type:p.length>0?p:["staff","client"]},{headers:{Authorization:`Bearer ${S}`}});F([...c.data.staff,...c.data.client])}else F([])}catch(t){console.error("Error fetching custom participants:",t),v.error("Failed to fetch participants")}},m=t=>{const{name:r,value:s}=t.target;E(i=>({...i,[r]:s})),r==="category"&&(D([]),K([{type:"",branchcode:"",teamId:"",staffType:"staff"}]))},b=t=>{const r=Array.from(t.target.files);if(r.length===0)return;const s=r.map(i=>({file:i,name:i.name,type:i.type.split("/")[1]||"file"}));E(i=>({...i,doc:[...i.doc,...s]}))},_=t=>{E(r=>{const s=[...r.doc];return s.splice(t,1),{...r,doc:s}})},P=t=>{j.some(r=>r.person_id===t.person_id)||V([...j,{person_id:t.person_id,role:t.role,isdocvisible:l.comm_type==="doc"}])},L=t=>{V(j.filter(r=>r.person_id!==t))},W=t=>{V(j.map(r=>r.person_id===t?{...r,isdocvisible:!r.isdocvisible}:r))},ne=(t,r)=>{if(t==="team"){const s=y.find(i=>i.type==="team"&&i.teamId===r);if(s&&s.branchcode){const i=r.split("/"),h=i[i.length-1],p=`${s.branchcode}/TEAM/${h}`;k.some(c=>c.target_id===p&&c.type===t)||D([...k,{target_id:p,type:t}]);return}}k.some(s=>s.target_id===r&&s.type===t)||D([...k,{target_id:r,type:t}])},I=(t,r,s)=>{const i=[...y];i[t][r]=s,r==="type"?(i[t].branchcode="",i[t].teamId=""):r==="branchcode"&&i[t].type==="team"&&(i[t].teamId=""),K(i)},ue=()=>{K([...y,{type:"",branchcode:"",teamId:"",staffType:"staff"}])},ae=t=>{var r,s,i,h;if(y.length>1){const p=[...y];p.splice(t,1),K(p),((r=p[t])==null?void 0:r.type)==="branch"&&((s=p[t])!=null&&s.branchcode)?D(k.filter(c=>!(c.type==="branch"&&c.target_id===p[t].branchcode))):((i=p[t])==null?void 0:i.type)==="team"&&((h=p[t])!=null&&h.teamId)&&D(k.filter(c=>!(c.type==="team"&&c.target_id===p[t].teamId)))}},xe=async t=>{var r,s;t.preventDefault(),N(!0);try{const i={branchcode:g.branchcode,client_code:g.client_code,project_code:g.project_code,title:l.title,notes:l.notes,comm_type:l.comm_type,status:l.status,meet_link:l.meet_link,start_date_time:l.start_date_time,end_date_time:l.end_date_time,doc_status:l.doc_status,category:l.category,field:l.field,custom:k,communication_participants:j},h=new FormData;h.append("data",JSON.stringify([i])),l.doc.forEach(c=>{h.append("URL",c.file)}),console.log("formataaaanew form",h);const p=await T.post(`${z}/doc_meet/create`,h,{headers:{Authorization:`Bearer ${S}`,"Content-Type":"multipart/form-data"}});p.status===201?B():x(p.data.message||"Failed to create communication")}catch(i){x(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"An error occurred"),v.error(`Error creating ${l.comm_type==="meeting"?"meeting":"document"}`)}finally{N(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsx(Ee,{position:$e}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[l.comm_type==="meeting"?e.jsx(vt,{className:"inline mr-2"}):e.jsx(Se,{className:"inline mr-2"}),l.comm_type==="meeting"?"Meeting Information":"Document Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Te,{className:"inline mr-1",size:14})," Title",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"title",value:l.title,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"text",placeholder:"Title",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Type",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsxs("select",{name:"comm_type",value:l.comm_type,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"meeting",children:"Meeting"}),e.jsx("option",{value:"doc",children:"Document"}),e.jsx("option",{value:"followup",children:"Follow-up"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:l.status,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"declined",children:"Declined"})]})]}),l.comm_type==="doc"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ct,{className:"inline mr-1",size:14})," Document Status"]}),e.jsxs("select",{name:"doc_status",value:l.doc_status,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"archived",children:"Archived"}),e.jsx("option",{value:"verified-closed",children:"Verified & Closed"}),e.jsx("option",{value:"rework",children:"Rework"})]})]}),l.comm_type==="meeting"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Nt,{className:"inline mr-1",size:14})," Meeting Link",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"meet_link",value:l.meet_link,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"url",placeholder:"https://meet.google.com/example",required:!0})]}),l.comm_type==="meeting"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(St,{className:"inline mr-1",size:14})," Start Date/Time",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"start_date_time",value:l.start_date_time,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"datetime-local",required:!0})]}),l.comm_type==="meeting"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Tt,{className:"inline mr-1",size:14})," End Date/Time",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsx("input",{name:"end_date_time",value:l.end_date_time,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"datetime-local",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ce,{className:"inline mr-1",size:14})," Category",e.jsx("span",{className:"text-red-700 text-lg m-2",children:"*"})]}),e.jsxs("select",{name:"category",value:l.category,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"branch",children:"Branch"}),e.jsx("option",{value:"team",children:"Team"}),e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Field"]}),e.jsxs("select",{name:"field",value:l.field,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",children:[e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"task",children:"Task"}),e.jsx("option",{value:"lead",children:"Lead"}),e.jsx("option",{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(Te,{className:"inline mr-1",size:14})," Notes"]}),e.jsx("textarea",{name:"notes",value:l.notes,onChange:m,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[100px]",placeholder:"Notes...",required:!0})]}),l.comm_type==="doc"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(Se,{className:"inline mr-1",size:14})," Documents"]}),e.jsx("input",{type:"file",id:"file-upload",multiple:!0,onChange:b,className:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--color-primary)] file:text-white hover:file:bg-[var(--color-hover)]"}),l.doc.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:l.doc.map((t,r)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded",children:[e.jsx("span",{className:"text-sm",children:t.name}),e.jsx("button",{type:"button",onClick:()=>_(r),className:"text-red-500 hover:text-red-700",children:e.jsx(fe,{size:16})})]},r))})]}),l.category==="custom"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>U(!A),children:[e.jsxs("h4",{className:"text-sm font-semibold",children:[e.jsx(ce,{className:"inline mr-2",size:16}),"Custom Filters (",k.length,")"]}),A?e.jsx(ze,{size:16}):e.jsx(De,{size:16})]}),A&&e.jsxs("div",{className:"mt-4 space-y-4",children:[y.map((t,r)=>e.jsxs("div",{className:"space-y-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h5",{className:"text-sm font-medium",children:["Filter ",r+1]}),y.length>1&&e.jsx("button",{type:"button",onClick:()=>ae(r),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(wt,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Filter Type"}),e.jsxs("select",{value:t.type,onChange:s=>I(r,"type",s.target.value),className:"w-full bg-white dark:bg-gray-800 text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select filter type"}),e.jsx("option",{value:"branch",children:"Branch"}),e.jsx("option",{value:"team",children:"Team"})]})]}),(t.type==="branch"||t.type==="team")&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Branch"}),e.jsxs("select",{value:t.branchcode,onChange:s=>{I(r,"branchcode",s.target.value),I(r,"teamId","")},className:"w-full bg-white dark:bg-gray-800 text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select branch"}),ee.map(s=>e.jsxs("option",{value:s.branchcode,children:[s.branchcode," - ",s.name]},s.branchcode))]})]}),t.type==="team"&&t.branchcode&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Team"}),e.jsxs("select",{value:t.teamId,onChange:s=>{I(r,"teamId",s.target.value),s.target.value&&ne("team",s.target.value)},className:"w-full bg-white dark:bg-gray-800 text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select team"}),O.filter(s=>s.branchcode===t.branchcode).map(s=>e.jsx("option",{value:s.team_id,children:s.team_name},s.team_id))]})]}),(t.type==="branch"||t.type==="team")&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Staff Type"}),e.jsxs("select",{value:t.staffType,onChange:s=>I(r,"staffType",s.target.value),className:"w-full bg-white dark:bg-gray-800 text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 focus:outline-none",children:[e.jsx("option",{value:"staff",children:"Staff"}),e.jsx("option",{value:"client",children:"Client"}),e.jsx("option",{value:"both",children:"Both"})]})]})]}),t.type==="branch"&&t.branchcode&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>ne("branch",t.branchcode),className:"text-xs bg-red-700 hover:bg-red-700 text-white px-2 py-1 rounded",children:"Add Branch Filter"})})]},r)),e.jsxs("button",{type:"button",onClick:ue,className:"flex items-center text-sm text-blue-500 hover:text-blue-700",children:[e.jsx(Le,{size:16,className:"mr-1"}),"Add Another Filter"]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>o(!$),children:[e.jsxs("h4",{className:"text-sm font-semibold",children:[e.jsx(ce,{className:"inline mr-2",size:16}),"Participants (",j.length,")"]}),$?e.jsx(ze,{size:16}):e.jsx(De,{size:16})]}),$&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:l.category==="custom"?"Select participants from filtered results":`Select participants from ${l.category}`}),H.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded",children:[e.jsxs("span",{children:[t.person_id," (",t.role,")"]}),j.some(r=>r.person_id===t.person_id)?e.jsx("button",{type:"button",onClick:()=>L(t.person_id),className:"text-red-500 hover:text-red-700",children:e.jsx(fe,{size:16})}):e.jsx("button",{type:"button",onClick:()=>P(t),className:"text-green-500 hover:text-green-700",children:e.jsx(_t,{size:16})})]},t.person_id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No participants available based on current filters"})]}),j.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Selected Participants"}),e.jsx("div",{className:"space-y-2",children:j.map(t=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded",children:[e.jsxs("span",{children:[t.person_id," (",t.role,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l.comm_type==="doc"&&e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:t.isdocvisible,onChange:()=>W(t.person_id),className:"rounded"}),e.jsx("span",{className:"text-xs",children:"View Doc"})]}),e.jsx("button",{type:"button",onClick:()=>L(t.person_id),className:"text-red-500 hover:text-red-700",children:e.jsx(fe,{size:16})})]})]},t.person_id))})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:J,disabled:C,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:xe,disabled:C,children:C?e.jsx(Pe,{}):l.comm_type==="meeting"?"Create Meeting":"Upload Document"})]})]})},It=({milestone:g,onSuccess:B,onCancel:J})=>{console.log("milestoneedataa",g);const[C,N]=n.useState(!1),[X,x]=n.useState(null),[j,V]=n.useState([]),[k,D]=n.useState([]),te=Q(d=>d.permissions)[0].role,O=ye(d=>d.branchCodeOptions),M=Q(d=>d.branchcode),H=te==="superadmin"?O:[{value:M,label:M}],F=ht(d=>d.allMilestonecodeOptions),$=Q(d=>d.accessToken),[o,A]=n.useState({branchcode:"",milestone_code:g.milestone_code,task_title:"",task_priority:"",start_date:"",end_date:"",team_id:"",handler_by:"",notes:"",collaborate:[{subtask_title:"",staff_id:"",status:"open"}],status:"draft"});n.useEffect(()=>{o.branchcode?U(o.branchcode):(V([]),D([]))},[o.branchcode]),n.useEffect(()=>{o.team_id?S(o.team_id):D([])},[o.team_id]);const U=async d=>{try{const u=await T.get(`${z}/teams/read?branchcode=${d}`,{headers:{Authorization:`Bearer ${$}`}});if(u.data&&u.data.data){const m=u.data.data.map(b=>({value:b.team_id,label:b.team_name,team_lead:b.team_lead}));V(m)}}catch(u){console.error("Error fetching teams:",u),v.error("Failed to load teams")}},S=async d=>{try{const u=await T.get(`${z}/teams/read/profile?team_id=${d}`,{headers:{Authorization:`Bearer ${$}`}});if(u.data&&u.data.data){const m=u.data.data.members.filter(_=>_.role!=="lead");D(m);const b=u.data.data.members.find(_=>_.role==="lead");b&&A(_=>({..._,handler_by:b.staff_id}))}}catch(u){console.error("Error fetching team members:",u),v.error("Failed to load team members")}},w=d=>{const{name:u,value:m}=d.target;A(b=>({...b,[u]:m}))},y=(d,u)=>{const{name:m,value:b}=u.target,_=[...o.collaborate];_[d]={..._[d],[m]:b},A(P=>({...P,collaborate:_}))},K=()=>{A(d=>({...d,collaborate:[...d.collaborate,{subtask_title:"",staff_id:"",status:"open"}]}))},l=d=>{if(o.collaborate.length===1)return;const u=o.collaborate.filter((m,b)=>b!==d);A(m=>({...m,collaborate:u}))},E=()=>{if(!o.branchcode)return x("Branch code is required"),!1;if(!o.milestone_code)return x("Milestone code is required"),!1;if(!o.task_title)return x("Task title is required"),!1;if(!o.start_date||!o.end_date)return x("Both start and end dates are required"),!1;if(new Date(o.start_date)>new Date(o.end_date))return x("End date must be after start date"),!1;if(!o.team_id)return x("Team is required"),!1;if(!o.handler_by)return x("Handler is required"),!1;for(const d of o.collaborate)if(!d.staff_id)return x("All collaborators must have a staff selected"),!1;return!0},se=async d=>{var m,b,_,P;if(d.preventDefault(),N(!0),x(null),!E()){N(!1);return}const u={data:[{branchcode:o.branchcode,milestone_code:g.milestone_code,task_title:o.task_title,task_priority:o.task_priority,start_date:o.start_date,end_date:o.end_date,handler_by:o.handler_by,team_id:o.team_id,notes:o.notes,collaborate:o.collaborate,status:o.status}]};try{const L=await T.post(`${z}/project/task/create`,u,{headers:{Authorization:`Bearer ${$}`}});L.status===201?(v.success("Task created successfully!"),B()):x(L.data.message||"Failed to create task")}catch(L){x(((b=(m=L.response)==null?void 0:m.data)==null?void 0:b.message)||"An error occurred"),v.error(((P=(_=L.response)==null?void 0:_.data)==null?void 0:P.message)||"Error creating task")}finally{N(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[X&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:X}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-md  font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(zt,{className:"inline mr-2"})," Task Information"]}),e.jsxs("h2",{className:"text-lg font-medium text-red-700 dark:text-gray-300 mt-2 text-center ",children:[e.jsx("span",{className:"text-gray-600 mr-4",children:" Milestone Duration: "}),Me(g.start_date)," - ",Me(g.end_date)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Dt,{className:"inline mr-1",size:14})," Branch Code"]}),e.jsxs("select",{name:"branchcode",value:o.branchcode,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),H==null?void 0:H.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(ce,{className:"inline mr-1",size:14})," Select Team"]}),e.jsxs("select",{name:"team_id",value:o.team_id,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!o.branchcode,children:[e.jsx("option",{value:"",children:"Select Team"}),j==null?void 0:j.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(bt,{className:"inline mr-1",size:14})," Select Milestone"]}),e.jsxs("select",{name:"milestone_code",value:o.milestone_code,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Milestone"}),F==null?void 0:F.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Task Title"]}),e.jsx("input",{name:"task_title",value:o.task_title,onChange:w,type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter task name",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Task Priority"]}),e.jsxs("select",{name:"task_priority",value:o.task_priority,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Priority"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"blocker",children:"Blocker"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ae,{className:"inline mr-1",size:14})," Start Date"]}),e.jsx("input",{name:"start_date",value:o.start_date,onChange:w,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Ae,{className:"inline mr-1",size:14})," Due Date"]}),e.jsx("input",{name:"end_date",value:o.end_date,onChange:w,type:"date",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Be,{className:"inline mr-1",size:14})," Handle By (Team Lead)"]}),e.jsx("input",{name:"handler_by",value:o.handler_by,readOnly:!0,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none cursor-not-allowed"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:o.status,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"inprocess",children:"In Progress"}),e.jsx("option",{value:"verified-closed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"}),e.jsx("option",{value:"rework",children:"Rework"}),e.jsx("option",{value:"drop",children:"Drop"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:"Collaborators"}),o.collaborate.map((d,u)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 relative",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(re,{className:"inline mr-1",size:14})," Sub Task Title"]}),e.jsx("input",{name:"subtask_title",value:d.subtask_title,onChange:m=>y(u,m),type:"text",className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",placeholder:"Enter Subtask Title",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(Be,{className:"inline mr-1",size:14})," Team Member"]}),e.jsxs("select",{name:"staff_id",value:d.staff_id,onChange:m=>y(u,m),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,disabled:!o.team_id,children:[e.jsx("option",{value:"",children:"Select Team Member"}),k==null?void 0:k.map(m=>e.jsxs("option",{value:m.staff_id,children:[m.staff_name," (",m.department,")"]},m.staff_id))]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Collaboration Status"]}),e.jsxs("select",{name:"status",value:d.status,onChange:m=>y(u,m),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"inprocess",children:"In Progress"}),e.jsx("option",{value:"verified-closed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"}),e.jsx("option",{value:"rework",children:"Rework"}),e.jsx("option",{value:"drop",children:"Drop"})]})]}),u>0&&e.jsx("button",{type:"button",onClick:()=>l(u),className:"absolute -right-2 -top-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(Ie,{size:16})})]},u)),e.jsxs("button",{type:"button",onClick:K,className:"flex items-center gap-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",disabled:!o.team_id,children:[e.jsx(Le,{size:16})," Add Another Collaborator"]})]})," ",e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(Mt,{className:"inline mr-2"})," Notes"]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(jt,{className:"inline mr-1",size:14})," Task Notes"]}),e.jsx("textarea",{name:"notes",value:o.notes,onChange:w,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[100px]",placeholder:"Enter the Task Notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:J,children:"Cancel"}),e.jsx("button",{type:"submit",onClick:se,disabled:C,className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-800 dark:hover:bg-red-900 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm disabled:opacity-70",children:C?e.jsx(Pe,{}):"Create Task"})]})]})};function qt(){const g=[{uri:"/documents/Abc Client Documents.pdf",fileType:"pdf",fileName:"Abc Client Documents.pdf",fileSize:"15MB"},{uri:"/documents/AbcProject draft.pdf",fileType:"pdf",fileName:"AbcProject Meeting Document.pdf",fileSize:"15MB"},{uri:"/documents/AbcProject Final 2 Documents.pdf",fileType:"pdf",fileName:"Abc company overview.pdf",fileSize:"15MB"},{uri:"/documents/AbcProject final Document.pdf",fileType:"pdf",fileName:"Abc structure Documents.pdf",fileSize:"15MB"}],[B,J]=n.useState(g[0]),[C,N]=n.useState(0),X=x=>{J(x),N(j=>j+1)};return e.jsxs("div",{className:"flex flex-col h-[1050px] p-6 bg-gray-50",children:[e.jsx("h1",{className:"text-xl font-bold text-red-800 mb-8",children:"Client Documents"}),e.jsxs("div",{className:"flex flex-1 gap-6 overflow-hidden",children:[e.jsxs("div",{className:"w-96 flex flex-col border-l border-gray-200 pl-6 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700 dark:text-gray-300",children:"Documents List"}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-800",children:e.jsx("ul",{className:"space-y-2",children:g.map(x=>e.jsx("li",{className:`p-3 rounded-lg cursor-pointer transition-all duration-200 ${B.uri===x.uri?"bg-red-50/80 border-l-4 border-red-600 shadow-sm dark:bg-red-900/20 dark:border-red-500":"bg-white hover:bg-gray-50 dark:bg-gray-800 dark:hover:bg-gray-700/70"}`,onClick:()=>X(x),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mr-3 mt-0.5",children:x.fileType==="pdf"?e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}):x.fileType==="doc"||x.fileType==="docx"?e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate dark:text-gray-200",children:x.fileName}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-xs font-mono text-gray-500 dark:text-gray-400",children:x.fileType.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:x.fileSize||"--"})]})]})]})},x.uri))})})]}),e.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx(ft,{documents:[B],pluginRenderers:yt,theme:{primary:"rgb(185 28 28)",secondary:"#BDBDBD",tertiary:"#BDBDBD",textPrimary:"#ffffff",textSecondary:"rgb(185 28 28)",textTertiary:"rgb(185 28 28)",disableThemeScrollbar:!1},config:{header:{disableHeader:!1,disableFileName:!0,retainURLParams:!1}}},C)})]})]})}const Rt=()=>{const g=pt({query:"(max-width: 768px)"}),[B,J]=n.useState(""),[C,N]=n.useState(1),[X,x]=n.useState(""),[j,V]=n.useState([]),[k,D]=n.useState(""),[ee,te]=n.useState([]),[O,M]=n.useState(!1),[H,F]=n.useState(0),[$,o]=n.useState(null),[A,U]=n.useState(!1),[S,w]=n.useState(!1),[y,K]=n.useState(),[l,E]=n.useState(!1),[se,d]=n.useState(""),[u,m]=n.useState(""),[b,_]=n.useState(""),[P,L]=n.useState(""),[W,ne]=n.useState(8),[I,ue]=n.useState(!1),[ae,xe]=n.useState(null),[t,r]=n.useState(null),[s,i]=n.useState(!1),[h,p]=n.useState("taskList"),c=ot(),{id:q}=dt();console.log("iddmilestonee",q);const[Y,be]=n.useState({delete_type:"",status:""}),Z=Q(a=>a.accessToken),{branches:Vt,managerOptions:Ot,branchCodeOptions:qe,fetchBranches:ge,isLoading:Re}=ye(),Ve=[{value:"",label:"All Branches"},{value:"active",label:"Active Branches"},{value:"inactive",label:"Inactive Branches"}],Oe=[{id:"taskList",label:"Task List"},{id:"milestonedoc",label:"Milestone Documents"}],He=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}];n.useEffect(()=>{ge(Z)},[Z]),n.useEffect(()=>{q&&(async()=>{try{const f=await T.get(`${z}/project/milestone/read?milestone_code=${encodeURIComponent(q)}`,{headers:{Authorization:`Bearer ${Z}`}});f.data.data&&f.data.data.length>0&&r(f.data.data[0])}catch(f){console.error("Error fetching milestone data",f),v.error("Failed to load milestone details")}})()},[q,Z]);const le=async(a=C,f=W,oe=B,de=k,Ht=b,ve=P,Ne=u)=>{var we,_e,Ce;M(!0),console.log("milestoneeeiddd",q);try{let G=`${z}/project/task/read?milestone_code=${encodeURIComponent(q)}&page=${a}&limit=${f}`;oe&&(G+=`&search=${oe}`),de&&(G+=`&status=${de}`),ve&&(G+=`&branchcode=${ve}`),Ne&&(G+=`&dec=${Ne}`),console.log("milestoneurll",G);const R=await T.get(G,{headers:{Authorization:`Bearer ${Z}`}});V((we=R==null?void 0:R.data)==null?void 0:we.data),F(((_e=R==null?void 0:R.data)==null?void 0:_e.length)||0),te(((Ce=R==null?void 0:R.data)==null?void 0:Ce.data)||[])}catch(G){console.error("Error fetching branch list",G),o("Failed to fetch branches")}finally{M(!1)}};n.useEffect(()=>{le()},[C,B,k,b,P,u,W]);const Ue=a=>{N(a)},Ke=()=>{U(!1),v.success("Task added successfully!"),ge(Z),le()},Ze=a=>{J(a),N(1)},Ge=a=>{console.log("branchhhhtaskk",a),K(a),w(!0)},Je=a=>{E(!0),xe(a)},Qe=async()=>{const a={data:{branchcode:ae.branchcode,project_code:ae.project_code,milestone_code:ae.milestone_code,delete_type:Y.delete_type,status:Y.status}};console.log("projectdeleteddataa",a);try{M(!0);const f=await T.delete(`${z}/project/milestone/delete`,{data:a,headers:{Authorization:`Bearer ${Z}`}});console.log("deleteemployeeresponse",f),(f==null?void 0:f.status)===201&&(E(!1),v.success("Milestone Deleted Successfully!"),le(),M(!1),be({delete_type:"",status:""}))}catch(f){console.error("Error deleting milestone",f),v.error("Failed to delete milestone"),M(!1)}finally{M(!1)}},je=a=>{const{name:f,value:oe}=a.target;be(de=>({...de,[f]:oe}))},Xe=()=>{m(a=>a==="desc"?"":"desc"),N(1)},We=a=>{D(a),N(1)},Ye=a=>{L(a),N(1)},et=a=>{ne(a),N(1)},tt=()=>[{data:"id"},{data:"Branch Code"},{data:"Milestone Name"},{data:"Task Name"},{data:"Duration Days"},{data:"Participant Count"},{data:"Task Priority"},{data:"Start Date"},{data:"End Date"},{data:"Handle By"},{data:"Status"},{data:"Actions",className:"text-center"}],at=()=>ee?ee.map((a,f)=>({id:a.id,data:[{data:a.id},{data:a.branchcode},{data:a.milestonetitle},{data:a.task_title},{data:a.duration_days},{data:a.participant_count},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${a.task_priority==="minor"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${a.task_priority==="minor"?"bg-green-800":"bg-red-700"}`}),a.task_priority.charAt(0).toUpperCase()+a.task_priority.slice(1)]})},{data:new Date(a.start_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})},{data:new Date(a.end_date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})},{data:a.handler_by},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${a.status==="completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${a.status==="completed"?"bg-green-800":"bg-red-700"}`}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})},{data:e.jsxs("div",{className:"flex  justify-center gap-2",children:[e.jsx(it,{to:`/task_view/${a.id}`,children:e.jsx("button",{className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View",children:e.jsx(Et,{size:18})})}),e.jsx("button",{className:"p-1 text-[var(--color-primary)] rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>Ge(a),title:"Edit",children:e.jsx(Pt,{size:18})}),e.jsx("button",{className:"p-1 text-red-600 rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>Je(a),title:"Delete",children:e.jsx(Ie,{size:18})})]}),className:"action-cell"}]})):[],ke=()=>{if(!t||!t.totaltask_count)return 0;const a=parseInt(t.totaltask_count),f=parseInt(t.verified_closedtask_count||0);return a===0?0:Math.round(f/a*100)},rt=()=>{w(!1),v.success("Task updated successfully!"),ge(Z),le()},st=()=>{i(!1),v.success("Meeting and Document Created successfully!")},nt=()=>{const a=he.book_new(),f=he.json_to_sheet(j);he.book_append_sheet(a,f,"Branches"),gt(a,"BranchList.xlsx")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)] p-5",children:"View Milestone"}),e.jsx("div",{children:e.jsxs("button",{className:"text-gray-500 bg-gray-200 px-3 py-1 rounded-lg mt-6",onClick:()=>c(-1),children:[e.jsx(At,{className:"inline rotate-180 text-gray-500 mr-3"}),"Go Back"]})})]}),t?e.jsxs("div",{className:"w-full max-w-full mx-auto p-15 bg-white dark:bg-gray-800 rounded-xl shadow-lg space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-red-700 dark:text-white",children:[e.jsx(Fe,{className:"inline mr-3"})," ",(t==null?void 0:t.miles_title)||"Milestone Details"]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:["New Meeting"," ",e.jsx(Bt,{className:"ml-2",size:15})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-100",children:"Milestone Code:"})," ",t==null?void 0:t.milestone_code]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-100",children:"Project Code:"})," ",t==null?void 0:t.project_code]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-purple-700 dark:text-gray-100",children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${(t==null?void 0:t.status)==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t==null?void 0:t.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-700 dark:text-gray-100",children:"Start Date:"})," ",t!=null&&t.start_date?new Date(t.start_date).toLocaleDateString():"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-red-700 dark:text-gray-100",children:"End Date:"})," ",t!=null&&t.end_date?new Date(t.end_date).toLocaleDateString():"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-gray-100",children:"Duration:"})," ",(t==null?void 0:t.duration_days)||0," days"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-gray-700 dark:text-gray-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Base Amount:"})," ₹",(t==null?void 0:t.base_amount)||"0.00"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Additional Amount:"})," ₹",(t==null?void 0:t.additional_amount)||"0.00"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Total Amount:"})," ₹",(t==null?void 0:t.total_amount)||"0.00"]})]}),e.jsxs("div",{className:"flex items-center  justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-700 dark:text-gray-200",children:[e.jsx("span",{className:"font-semibold",children:"Task Progress:"})," ",t!=null&&t.totaltask_count?`${t.verified_closedtask_count||0}/${t.totaltask_count} tasks completed`:"No tasks yet"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-[250px] rounded-full h-2.5 bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{className:"bg-red-700 h-2.5 rounded-full transition-all duration-500",style:{width:`${ke()}%`}})}),e.jsx("div",{children:e.jsxs("span",{className:"text-red-700 ml-3",children:[ke(),"%"]})})]})]}),(t==null?void 0:t.revision_reason)&&e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-200",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Revision Reason:"}),e.jsx("br",{}),t.revision_reason]})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Assigned by:"})," ",(t==null?void 0:t.handler_by)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Created by:"})," ",(t==null?void 0:t.createby)||"N/A"]})]})]}):e.jsx("div",{children:"Loading milestone details..."}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 ml-5 mb-5 mt-10",children:e.jsx("nav",{className:"flex -mb-px",children:Oe.map(a=>e.jsx("button",{onClick:()=>p(a.id),className:`mr-8 py-4 px-1 border-b-2 font-medium text-sm ${h===a.id?"border-red-500 text-red-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a.label},a.id))})}),h==="taskList"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)] ",children:[e.jsx(Ft,{className:"inline mr-4"})," ",t==null?void 0:t.miles_title," Tasks"]}),g&&e.jsx("button",{onClick:()=>ue(!I),className:"p-2 bg-gray-200 rounded-md",children:I?"Hide Filters":"Show Filters"})]}),e.jsx(Ee,{position:$e,reverseOrder:!1}),e.jsx("div",{className:`flex ${g?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsxs("div",{className:`flex ${g?"flex-col":"flex-row"} gap-4`,children:[e.jsx(pe,{options:He,selectedValue:W,onSelect:et,placeholder:"Items per page",className:"w-full md:w-[150px]"}),e.jsxs("button",{onClick:nt,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-3 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(xt,{className:"mr-1"}),!g&&"Export Excel"]}),e.jsxs("button",{onClick:()=>U(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:[!g&&"Add New Task"," +"]})]})}),e.jsx("div",{className:`${g&&!I?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${g?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(pe,{options:Ve,selectedValue:k,onSelect:We,placeholder:"Branch Status",className:"w-full md:w-[200px]"}),e.jsx(pe,{options:qe,selectedValue:P,onSelect:Ye,placeholder:"Branch Code",className:"w-full md:w-[200px]",isLoading:Re}),e.jsxs("button",{onClick:Xe,className:`${g?"w-full":"w-[200px]"} h-[40px] text-white bg-[var(--color-primary)] hover-effect px-2 py-1 rounded-sm`,children:["Sort ",u==="desc"?"↑":"↓"]}),e.jsx("div",{className:`${g?"w-full":"w-[200px] mt-3"}`,children:e.jsx(ut,{value:B,onChange:Ze,placeholder:"Search branches...",className:"w-full"})})]})}),O&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),$&&e.jsx("div",{className:"text-red-500 text-center py-4",children:$}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(ct,{thead:tt,tbody:at,responsive:!0,className:"min-w-full"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx(mt,{total:H,currentPage:C,defaultPageSize:W,onChange:Ue,paginationLabel:"branches",isScroll:!0})})]}),h==="milestonedoc"&&e.jsx(qt,{})]}),e.jsx(ie,{isVisible:A,className:"w-full md:w-[800px]",onClose:()=>U(!1),title:"Add New Task Form",children:e.jsx(It,{milestone:t,onSuccess:Ke,onCancel:()=>U(!1)})}),e.jsx(ie,{isVisible:S,className:"w-full md:w-[800px]",onClose:()=>w(!1),title:"Edit Task Form",children:e.jsx(kt,{taskData:y,onSuccess:rt,onCancel:()=>w(!1)})}),e.jsx(ie,{isVisible:l,className:"w-full md:w-[600px]",onClose:()=>E(!1),title:"Drop Milestone",children:e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(Fe,{className:"inline mr-2"})," Drop Milestone"]}),e.jsx("p",{className:"text-gray-500 text-sm font-medium text-center",children:"Are you sure you want to Drop this Milestone?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx($t,{className:"inline mr-1",size:14})," Type"]}),e.jsxs("select",{name:"delete_type",value:Y.delete_type,onChange:je,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"temp",children:"Temporary"}),e.jsx("option",{value:"permanent",children:"Permanent"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(me,{className:"inline mr-1",size:14})," Status"]}),e.jsxs("select",{name:"status",value:Y.status,onChange:je,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"revised",children:"Revised"}),e.jsx("option",{value:"client_review",children:"Client_review"}),e.jsx("option",{value:"drop",children:"Drop"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>E(!1),disabled:O,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:Qe,disabled:O,children:O?"Processing...":"Confirm"})]})]})}),e.jsx(ie,{isVisible:s,className:"w-full md:w-[800px]",onClose:()=>i(!1),title:"Create Meeting",children:e.jsx(Lt,{milestone:t,onSuccess:st,onCancel:()=>i(!1)})})]})},Ha=lt(Rt);export{Ha as default};
