import{r as t,j as e,b as Le}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{a as V,B as I,b as M}from"./api-C04JdqFc.js";import{O as ae,V as p}from"./index-DxoBGdjx.js";import{B as te}from"./ButtonLoader-Z62NVHwI.js";import{u as q}from"./AuthStore-BnYeBJES.js";import{C as De}from"./clock-CzOQJT5p.js";import{C as _e}from"./clipboard-list-C2ET-QCv.js";import{C as X}from"./calendar-C_LRGMui.js";import{F as Z}from"./file-text-BNGbNc3I.js";import{D as Te}from"./DataTable-DtyPIAGZ.js";import{C as $e}from"./CustomPagination-CBTcVvJz.js";import{S as Fe}from"./SearchInput-CMdOUuSO.js";import{M as O}from"./Modal-BCIUwH-b.js";import{D as ee}from"./DrapDown-CEm3nLdF.js";import{F as Be,u as P,w as ze}from"./xlsx-DTxMWUdD.js";import{u as Ae}from"./useBranchStore-kvv3vD_e.js";import{u as Me}from"./use-click-outside-BhLpsQYS.js";import{C as Oe,E as Pe}from"./EditLeaveForm-ZCAHbRg3.js";import{E as Ve}from"./eye-2Mk8PZw-.js";import{S as Ie}from"./square-pen-hueQTsQ_.js";import{T as qe}from"./trash-2-AUNIB88j.js";const xa=({leaveRequest:s,onSuccess:b,onCancel:_})=>{const[l,d]=t.useState({leave_type:"",start_date:"",end_date:"",reason:"",remarks:""}),[y,v]=t.useState(!1),[j,k]=t.useState(null),S=q(r=>r.accessToken),T=[{value:"casual",label:"Casual Leave"},{value:"sick",label:"Sick Leave"},{value:"event",label:"Event Leave"}];t.useEffect(()=>{s&&d({leave_type:s.leave_type||"",start_date:s.start_date||"",end_date:s.end_date||"",reason:s.reason||"",remarks:s.remarks||""})},[s]);const u=r=>{const{name:c,value:x}=r.target;d(i=>({...i,[c]:x}))},h=(r,c)=>{d(x=>({...x,[r]:c}))};console.log("leaverequesttt",s);const $=async r=>{var c,x,i,w;if(r.preventDefault(),v(!0),new Date(l.end_date)<new Date(l.start_date)){k("End date cannot be before start date"),p.error("End date cannot be before start date"),v(!1);return}try{const o=await V.put(`${I}/users/leavereq/edit/${s.req_id}`,l,{headers:{Authorization:`Bearer ${S}`}});o.status===200?(p.success("Leave request updated successfully"),b()):(k(o.data.message||"Failed to update leave request"),p.error(o.data.message||"Failed to update leave request"))}catch(o){k(((x=(c=o.response)==null?void 0:c.data)==null?void 0:x.message)||"An error occurred"),p.error(((w=(i=o.response)==null?void 0:i.data)==null?void 0:w.message)||"Failed to update leave request")}finally{v(!1)}},N=r=>r?new Date(r).toISOString().split("T")[0]:"";return e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[e.jsx(ae,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold border-b pb-2 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700",children:[e.jsx(De,{className:"inline mr-2"})," Update Leave Request"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(_e,{className:"inline mr-1",size:14})," Leave Type"]}),e.jsx("select",{name:"leave_type",value:l.leave_type,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:T.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(X,{className:"inline mr-1",size:14})," Start Date"]}),e.jsx("input",{name:"start_date",type:"date",value:N(l.start_date),onChange:r=>h("start_date",r.target.value),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx(X,{className:"inline mr-1",size:14})," End Date"]}),e.jsx("input",{name:"end_date",type:"date",value:N(l.end_date),onChange:r=>h("end_date",r.target.value),className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,min:l.start_date||new Date().toISOString().split("T")[0]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(Z,{className:"inline mr-1",size:14})," Reason"]}),e.jsx("textarea",{name:"reason",value:l.reason,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[100px]",placeholder:"Reason for leave...",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:[e.jsx(Z,{className:"inline mr-1",size:14})," Remarks"]}),e.jsx("textarea",{name:"remarks",value:l.remarks,onChange:u,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[60px]",placeholder:"Additional remarks..."})]})]}),j&&e.jsx("div",{className:"text-red-500 text-sm text-center py-2",children:j}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:_,disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",onClick:$,disabled:y,children:y?e.jsx(te,{}):"Update Leave Request"})]})]})},ga=()=>{const s=Me({query:"(max-width: 768px)"}),[b,_]=t.useState(""),[l,d]=t.useState(1),[y,v]=t.useState([]),[j,k]=t.useState(""),[S,T]=t.useState([]),[u,h]=t.useState(!1),[$,N]=t.useState(0),[r,c]=t.useState(null),[x,i]=t.useState(!1),[w,o]=t.useState(!1),[re,se]=t.useState(),[le,C]=t.useState(!1),[oe,ne]=t.useState(""),[F,de]=t.useState(""),[U,Ue]=t.useState(""),[B,ce]=t.useState(""),[E,ie]=t.useState(8),[z,me]=t.useState(!1),f=q(a=>a.accessToken);q(a=>a.branchcode);const{branches:Ye,managerOptions:We,branchCodeOptions:ue,fetchBranches:L,isLoading:xe}=Ae(),ge=[{value:20,label:"20 per page"},{value:40,label:"30 per page"},{value:50,label:"40 per page"},{value:80,label:"50 per page"},{value:100,label:"100 per page"},{value:200,label:"100 per page"}];t.useEffect(()=>{L(f)},[f]);const D=async(a=l,m=E,Y=b,W=j,H=U,A=B,Q=F)=>{var R,G,J,K;h(!0);try{let g=`${I}/master/leavetypes/read?branchcode=${A}&page=${a}&limit=${m}`;Y&&(g+=`&search=${Y}`),W&&(g+=`&status=${W}`),H&&(g+=`&manager_id=${H}`),A&&(g+=`&branchcode=${A}`),Q&&(g+=`&dec=${Q}`);const n=await V.get(g,{headers:{Authorization:`Bearer ${f}`}});console.log("responseeeeleavee",n),v((R=n==null?void 0:n.data)==null?void 0:R.data),N(((J=(G=n==null?void 0:n.data)==null?void 0:G.data)==null?void 0:J.totalDocuments)||0),T(((K=n==null?void 0:n.data)==null?void 0:K.data)||[])}catch(g){console.error("Error fetching branch list",g),c("Failed to fetch branches")}finally{h(!1)}};t.useEffect(()=>{D()},[l,b,j,U,B,F,E]);const pe=a=>{d(a)},he=()=>{i(!1),p.success("Leave Type added successfully!",M),L(f),D()},fe=a=>{_(a),d(1)},be=a=>{se(a),o(!0)},ye=a=>{C(!0),ne(a)},ve=async()=>{const a=Number(oe);try{h(!0);const m=await V.delete(`${I}/master/leavetypes/delete/${a}`,{headers:{Authorization:`Bearer ${f}`}});(m==null?void 0:m.status)===201&&(C(!1),p.success("Leave deleted successfully!",M),L(f),D())}catch(m){console.error("Error deleting leave",m),p.error("Failed to delete Leave")}finally{h(!1)}},je=()=>{de(a=>a==="desc"?"":"desc"),d(1)},ke=a=>{ce(a),d(1)},Se=a=>{ie(a),d(1)},Ne=()=>[{data:"id"},{data:"Branch Code"},{data:"Leave Type"},{data:"Year"},{data:"TotalDays"},{data:"Status"},{data:"Actions"}],we=()=>S?S.map(a=>({id:a.id,data:[{data:a.id},{data:a.branchcode},{data:a.name},{data:a.year},{data:a.total_days},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${a.status==="open"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${a.status==="open"?"bg-green-800":"bg-red-700"}`}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})},{data:e.jsxs("div",{className:"flex  justify-center gap-1 ",children:[e.jsx(Le,{to:`/branch/${a.id}`,children:e.jsx("button",{className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View",children:e.jsx(Ve,{size:18})})}),e.jsx("button",{className:"p-1 text-[var(--color-primary)] rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>be(a),title:"Edit",children:e.jsx(Ie,{size:18})}),e.jsx("button",{className:"p-1 text-red-600 rounded hover:text-gray-500 dark:hover:text-gray-300",onClick:()=>ye(a.id),title:"Delete",children:e.jsx(qe,{size:18})})]}),className:"action-cell"}]})):[],Ce=()=>{o(!1),p.success("Leave updated successfully!",M),L(f),D()},Ee=()=>{const a=P.book_new(),m=P.json_to_sheet(y);P.book_append_sheet(a,m,"Software"),ze(a,"SoftWareList.xlsx")};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col min-h-screen w-full",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center ",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"LeaveType Management"}),s&&e.jsx("button",{onClick:()=>me(!z),className:"p-2 bg-gray-200 rounded-md",children:z?"Hide Filters":"Show Filters"})]}),e.jsx(ae,{position:"top-center",reverseOrder:!1}),e.jsx("div",{className:`flex ${s?"flex-col":"items-end justify-end"} gap-4 mb-5`,children:e.jsx("div",{className:`flex ${s?"flex-col":"flex-row"} gap-4`,children:e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",children:[!s&&"New Leave Type"," +"]})})}),e.jsx("div",{className:`${s&&!z?"hidden":"block"} mb-4`,children:e.jsxs("div",{className:`${s?"grid grid-cols-1 gap-3":"flex flex-wrap justify-between items-center gap-3"}`,children:[e.jsx(ee,{options:ue,selectedValue:B,onSelect:ke,placeholder:"Branch Code",className:"w-full md:w-[200px]",isLoading:xe}),e.jsxs("button",{onClick:je,className:`${s?"w-full":"w-[200px]"} h-[40px] text-white bg-[var(--color-primary)] hover-effect px-2 py-1 rounded-sm`,children:["Sort ",F==="desc"?"↑":"↓"]}),e.jsx(ee,{options:ge,selectedValue:E,onSelect:Se,placeholder:"Items per page",className:"w-full md:w-[200px]"}),e.jsxs("button",{onClick:Ee,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-9 dark:bg-gray-800 dark:text-gray-300 py-2.5",children:[e.jsx(Be,{className:"mr-1"}),!s&&"Export Excel"]}),e.jsx("div",{className:`${s?"w-full":"w-[180px] mt-3"}`,children:e.jsx(Fe,{value:b,onChange:fe,placeholder:"Search branches...",className:"w-full"})})]})}),u&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),r&&e.jsx("div",{className:"text-red-500 text-center py-4",children:r}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Te,{thead:Ne,tbody:we,responsive:!0,className:"min-w-[50%]"})})]}),e.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:e.jsx($e,{total:$,currentPage:l,defaultPageSize:E,onChange:pe,paginationLabel:"branches",isScroll:!0})})]}),e.jsx(O,{isVisible:x,className:"w-full md:w-[800px]",onClose:()=>i(!1),title:"CREATE NEW LEAVETYPE",children:e.jsx(Oe,{onSuccess:he,onCancel:()=>i(!1)})}),e.jsx(O,{isVisible:w,className:"w-full md:w-[800px]",onClose:()=>o(!1),title:"EDIT LEAVE TYPE",children:e.jsx(Pe,{branch:re,onSuccess:Ce,onCancel:()=>o(!1)})}),e.jsx(O,{isVisible:le,className:"w-full md:w-[600px]",onClose:()=>C(!1),title:"DELETE LEAVE TYPE",children:e.jsxs("div",{className:"flex flex-col gap-6 justify-center items-center",children:[e.jsx("p",{className:"text-gray-500 text-lg font-bold text-center",children:"Are you sure you want to delete this Leavetype?"}),e.jsxs("div",{className:"flex gap-4 flex-wrap justify-center",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-[var(--color-secondary)] hover:bg-[var(--color-hover-secondary)] text-gray-800 hover-effect dark:text-gray-700 rounded dark:hover:bg-gray-500 transition",disabled:u,onClick:()=>C(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded hover:bg-[var(--color-hover)] hover-effect transition",disabled:u,onClick:ve,children:u?e.jsx(te,{}):"Confirm"})]})]})})]})})};export{xa as E,ga as L};
