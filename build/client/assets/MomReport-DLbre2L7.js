import{w as fe}from"./with-props-DF0D9zIo.js";import{r as o,j as t}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as he}from"./DataTable-DtyPIAGZ.js";import{C as xe}from"./CustomPagination-CBTcVvJz.js";import{D as C}from"./DrapDown-CEm3nLdF.js";import{F as ge,u as $,w as Se}from"./xlsx-DTxMWUdD.js";import{B as D,a as M,t as je}from"./api-C04JdqFc.js";import{V as j,O as be}from"./index-DxoBGdjx.js";import{u as b}from"./AuthStore-BnYeBJES.js";import{u as we}from"./useBranchStore-kvv3vD_e.js";import{u as ye}from"./use-click-outside-BhLpsQYS.js";import{D as Ne}from"./index.es-Dy-HqQhS.js";/* empty css                         */import{M as ve}from"./Modal-BCIUwH-b.js";import{M as _e}from"./MomViewPage-DyfwsTXQ.js";import{A as Ce,a as $e}from"./arrow-up-narrow-wide-BXfcg2ON.js";import{E as De}from"./eye-2Mk8PZw-.js";import"./index-knF4tUPh.js";/* empty css            */import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";import"./clsx-B-dksMZM.js";import"./index-CyJ3O4p6.js";import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./index-DTbJanog.js";import"./calendar-C_LRGMui.js";import"./users-CXAhoVGa.js";import"./clipboard-check-ZUIfxiNP.js";const Me=()=>{var T;const R=ye({query:"(max-width: 768px)"}),[F,h]=o.useState(1),[p,m]=o.useState(!1),[I,z]=o.useState(0),[E,V]=o.useState(null),[c,U]=o.useState(""),[x,w]=o.useState(""),[y,P]=o.useState(""),[G,Ee]=o.useState(10),[d,W]=o.useState(null),[N,q]=o.useState(null),[v,Q]=o.useState(null),[Y,O]=o.useState([]),[H,B]=o.useState([]),[g,J]=o.useState(""),[K,k]=o.useState(!1),[X,Z]=o.useState(null),l=b(e=>e.accessToken),ee=b(e=>e.permissions),_=b(e=>e.staff_id),S=b(e=>e.branchcode),a=((T=ee[0])==null?void 0:T.role)||"employee",{branchCodeOptions:te,fetchBranches:ae,isLoading:se}=we(),re=()=>a==="superadmin"?te:[];o.useEffect(()=>{a==="superadmin"&&ae(l)},[l,a]),o.useEffect(()=>{a!=="superadmin"&&(w(_),u())},[a,_]),o.useEffect(()=>{a==="superadmin"&&(async()=>{if(a!=="superadmin"||!c){O([]);return}m(!0);try{const n=`${D}/users/read?branchcode=${c}`,s=await M.get(n,{headers:{Authorization:`Bearer ${l}`}});if(s.data&&s.data.data){const r=s.data.data.map(i=>({value:i.staff_id,label:`${i.firstname} ${i.lastname} (${i.staff_id})`}));O(r)}}catch(n){console.error("Error fetching staff list",n),j.error("Failed to fetch staff")}finally{m(!1)}})()},[c,l,a]),o.useEffect(()=>{(a==="superadmin"?c:S)&&(async()=>{const n=a==="superadmin"?c:S;if(!n){B([]);return}m(!0);try{const s=`${D}/project/overview/dropdown?branchcode=${n}`,r=await M.get(s,{headers:{Authorization:`Bearer ${l}`}});if(r.data&&r.data.data){const i=r.data.data.map(f=>({value:f.project_code,label:`${f.title} (${f.project_code})`}));B(i)}}catch(s){console.error("Error fetching project list",s),j.error("Failed to fetch projects")}finally{m(!1)}})()},[c,l,a,S]);const u=async()=>{var n;const e=a!=="superadmin"?_:x;if(!(!e&&a!=="superadmin")){m(!0);try{let s=`${D}/doc_meet/read?person_id=${encodeURIComponent(e)}&role=staff&comm_type=meeting`;if(y&&(s+=`&project_code=${y}`),N&&v){const i=A(N),f=A(v);s+=`&start_date=${i}&end_date=${f}`}g&&(s+=`&dec=${g}`);const r=await M.get(s,{headers:{Authorization:`Bearer ${l}`}});r.data&&(W(r.data),z(((n=r.data.data)==null?void 0:n.length)||0))}catch(s){console.error("Error fetching meeting data",s),j.error("Failed to fetch meeting data"),V("Failed to fetch data")}finally{m(!1)}}},A=e=>{if(!e)return"";const n=new Date(e),s=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),i=n.getDate().toString().padStart(2,"0");return`${s}-${r}-${i}`},oe=e=>{h(e)},ne=e=>{U(e),w(""),P(""),h(1)},de=e=>{w(e),h(1)},ce=e=>{P(e),h(1),u()},ie=e=>{const[n,s]=e;q(n),Q(s),u()},le=()=>{J(e=>e==="desc"?"":"desc"),u()},pe=()=>{if(!(d!=null&&d.data)||d.data.length===0){j.error("No data to export");return}const e=d.data.map(r=>({"Meeting ID":r.meet_id,Title:r.title,"Branch Code":r.branchcode,"Project Code":r.project_code||"N/A","Start Date":new Date(r.start_date_time).toLocaleString(),"End Date":new Date(r.end_date_time).toLocaleString(),Status:r.status,"Created By":r.createdby})),n=$.book_new(),s=$.json_to_sheet(e);$.book_append_sheet(n,s,"MeetingReport"),Se(n,"MeetingReport.xlsx")},L=e=>e?new Date(e).toLocaleString():"N/A",me=()=>[{data:"Meeting ID"},{data:"Title"},{data:"Branch"},{data:"Project"},{data:"Start Time"},{data:"End Time"},{data:"Status"},{data:"Actions"}],ue=()=>d!=null&&d.data?d.data.map(e=>({id:e.meet_id,data:[{data:e.meet_id},{data:e.title},{data:e.branchcode},{data:e.project_code||"N/A"},{data:L(e.start_date_time)},{data:L(e.end_date_time)},{data:t.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${e.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[t.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${e.status==="active"?"bg-green-800":"bg-red-700"}`}),e.status.charAt(0).toUpperCase()+e.status.slice(1)]})},{data:t.jsx("button",{className:"bg-blue-400/25 text-xs dark:bg-blue-700/15 px-2 py-1 dark:text-blue-200 text-blue-700 rounded-2xl",onClick:()=>{Z(e),k(!0)},children:t.jsx(De,{size:16})})}]})):[];return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-col min-h-screen",children:t.jsxs("div",{className:"p-4 flex-grow",children:[t.jsx("div",{className:"flex justify-between items-center mb-4",children:t.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-5",children:"MOM Report"})}),t.jsx(be,{position:je,reverseOrder:!1}),t.jsxs("div",{className:"flex flex-col gap-4 mb-5",children:[t.jsxs("div",{className:`grid grid-cols-1 ${a!=="superadmin"?"md:grid-cols-2 lg:grid-cols-2 gap-3":"md:grid-cols-4 lg:grid-cols-4 gap-20"}`,children:[a==="superadmin"&&t.jsx(C,{options:re(),selectedValue:c,onSelect:ne,placeholder:"Select Branch",className:"w-[245px]",isLoading:se}),a==="superadmin"&&t.jsx(C,{options:Y,selectedValue:x,onSelect:de,placeholder:"Select Staff",className:"w-[245px]",disabled:!c,isLoading:p}),t.jsx(C,{options:H,selectedValue:y,onSelect:ce,placeholder:"Select Project",className:"w-[245px]",disabled:a==="superadmin"?!c:!S,isLoading:p}),t.jsx("div",{className:"w-[245px]",children:t.jsx(Ne,{selectsRange:!0,startDate:N,endDate:v,onChange:ie,placeholderText:"Select date range",className:"w-full p-2 border rounded h-[40px]",isClearable:!0})})]}),t.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[t.jsxs("div",{className:`flex ${a!=="superadmin"?"gap-91":"gap-19"}`,children:[t.jsxs("button",{onClick:le,className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect px-18 h-[40px] rounded-sm",children:[g==="desc"?t.jsx(Ce,{className:"mr-1"}):t.jsx($e,{className:"mr-1"}),"Sort ",g==="desc"?"Desc":"Asc"]}),t.jsxs("button",{onClick:pe,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-2 dark:bg-gray-800 dark:text-gray-300 py-2 w-[245px]",disabled:!(d!=null&&d.data),children:[t.jsx(ge,{className:"mr-1"}),!R&&"Export Excel"]})]}),a==="superadmin"&&t.jsx("button",{onClick:u,className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",disabled:!x||p,children:p?"Loading...":"Generate Report"})]})]}),p&&t.jsx("div",{className:"text-center py-4",children:"Loading..."}),E&&t.jsx("div",{className:"text-red-500 text-center py-4",children:E}),(d==null?void 0:d.data)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsx(he,{thead:me,tbody:ue,responsive:!0,className:"min-w-full"})}),t.jsx("div",{className:"bottom-0 border-t border-gray-200 dark:border-gray-700 p-4",children:t.jsx(xe,{total:I,currentPage:F,defaultPageSize:G,onChange:oe,paginationLabel:"meetings",isScroll:!0})})]}),!p&&!d&&t.jsx("div",{className:"text-center py-10 text-gray-500",children:a!=="superadmin"?"Loading your meeting data...":c?x?"Click 'Generate Report' to view data":"Please select Staff":"Please select Branch to view available options"})]})}),t.jsx(ve,{isVisible:K,className:"w-full md:w-[800px]",onClose:()=>k(!1),title:"Meeting Details",children:t.jsx(_e,{meeting:X})})]})},nt=fe(Me);export{nt as default};
