import{w as U}from"./with-props-DF0D9zIo.js";import{r as i,j as e}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as N}from"./DataTable-DtyPIAGZ.js";import{F as A,u,w as O}from"./xlsx-DTxMWUdD.js";import{t as H,B as W,a as G}from"./api-C04JdqFc.js";import{O as I,V as v}from"./index-DxoBGdjx.js";import{u as k}from"./AuthStore-BnYeBJES.js";import{D as V}from"./index.es-Dy-HqQhS.js";/* empty css                         */import{C as Y}from"./clock-CzOQJT5p.js";import{H as q}from"./hourglass-BDGbSW0U.js";import{B as w,L as S}from"./list-DzQOn6sg.js";import"./index-knF4tUPh.js";/* empty css            */import"./createLucideIcon-RccWoOaL.js";import"./react-_sXfQCJm.js";import"./clsx-B-dksMZM.js";import"./index-CyJ3O4p6.js";const J=()=>{var y,_;const[c,p]=i.useState(!1),[f,$]=i.useState(null),[s,h]=i.useState(null),[n,E]=i.useState(null),[d,T]=i.useState(null),D=k(r=>r.accessToken),g=k(r=>r.staff_id),C=async()=>{if(!g||!n||!d){h(null);return}p(!0);try{const r=j(n),t=j(d),a=`${W}/report/usersummary/read?staff_id=${encodeURIComponent(g)}&start_date=${r}&end_date=${t}`,o=await G.get(a,{headers:{Authorization:`Bearer ${D}`}});o.data&&h(o.data)}catch(r){console.error("Error fetching user summary data",r),v.error("Failed to fetch user summary data"),$("Failed to fetch data")}finally{p(!1)}},j=r=>{if(!r)return"";const t=new Date(r),a=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),m=t.getDate().toString().padStart(2,"0");return`${a}-${o}-${m}`},R=r=>{const[t,a]=r;E(t),T(a)},M=()=>{var o;if(!((o=s==null?void 0:s.data)!=null&&o.projectsummary)||s.data.projectsummary.length===0){v.error("No data to export");return}const r=s.data.projectsummary.flatMap(m=>m.milestones_summary.flatMap(b=>b.taskparticipantsummary.map(l=>({project_code:m.project_code,milestone_code:b.milestone_code,staff_id:l.staff_id,staff_name:`${l.firstname} ${l.lastname}`,total_tasks:l.total_tasks,total_duration_minutes:l.total_duration_minutes,total_working_hours:(l.total_duration_minutes/60).toFixed(2),status:m.status})))),t=u.book_new(),a=u.json_to_sheet(r);u.book_append_sheet(t,a,"EmployeeSummaryReport"),O(t,"EmployeeSummaryReport.xlsx")},F=()=>{C()},x=r=>{if(isNaN(r))return"0 minutes";const t=Math.floor(r/60),a=Math.round(r%60);return t>0&&a>0?`${t} hour${t!==1?"s":""} ${a} minute${a!==1?"s":""}`:t>0?`${t} hour${t!==1?"s":""}`:`${a} minute${a!==1?"s":""}`},L=()=>[{data:"Project Code"},{data:"Status"},{data:"Total Tasks"},{data:"Total Duration"}],z=()=>{var r;return(r=s==null?void 0:s.data)!=null&&r.projectsummary?s.data.projectsummary.map((t,a)=>({id:t.project_code||a,data:[{data:t.project_code},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${t.status==="completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${t.status==="completed"?"bg-green-800":"bg-red-700"}`}),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})},{data:t.total_tasks},{data:x(t.total_duration_minutes)}]})):[]},P=()=>[{data:"Milestone Code"},{data:"Total Tasks"},{data:"In Progress"},{data:"Completed"},{data:"Total Duration"}],B=()=>{var t;return(t=s==null?void 0:s.data)!=null&&t.projectsummary?s.data.projectsummary.flatMap(a=>a.milestones_summary.map(o=>({...o,project_code:a.project_code}))).map((a,o)=>({id:a.milestone_code||o,data:[{data:a.milestone_code},{data:a.total_tasks},{data:a.total_inprogress},{data:a.total_verified_closed},{data:x(a.overall_task_duration)}]})):[]};return e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)] mb-5",children:"Employee Work Summary"})}),e.jsx(I,{position:H,reverseOrder:!1}),e.jsx("div",{className:"flex flex-col gap-4 mb-5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-39",children:[e.jsx("div",{className:"w-full",children:e.jsx(V,{selectsRange:!0,startDate:n,endDate:d,onChange:R,placeholderText:"Select date range",className:"w-full p-2 border rounded h-[40px]",isClearable:!0})}),e.jsxs("button",{onClick:M,className:"flex items-center justify-center text-gray-400 bg-white focus:outline-non font-medium text-sm rounded-sm border border-dotted border-gray-400 hover:text-red-700/70 px-2 dark:bg-gray-800 dark:text-gray-300 py-2",disabled:!((y=s==null?void 0:s.data)!=null&&y.projectsummary),children:[e.jsx(A,{className:"mr-1"}),"Export Excel"]}),e.jsx("button",{onClick:F,className:"flex items-center justify-center text-white bg-[var(--color-primary)] hover-effect dark:bg-red-800 focus:outline-non font-medium text-sm rounded-sm px-5 py-2.5",disabled:!n||!d||c,children:c?"Loading...":"Generate Report"})]})}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-200 dark:bg-gray-800 rounded-lg",children:[e.jsx("h3",{className:"text-lg text-red-700 font-semibold mb-2",children:"Employee Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-3 flex items-center",children:[e.jsx(Y,{className:"mr-1",size:16})," Date Range"]}),e.jsxs("p",{className:"font-medium",children:[new Date(s.data.start_date).toLocaleDateString()," - ",new Date(s.data.end_date).toLocaleDateString()]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-3 flex items-center",children:[e.jsx(q,{className:"mr-1",size:16})," Total Working Hours"]}),e.jsx("p",{className:"font-medium",children:x(s.data.total_duration_minutes)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-3 flex items-center",children:[e.jsx(w,{className:"mr-1",size:16})," Projects Worked"]}),e.jsx("p",{className:"font-medium",children:s.data.total_projects_worked})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-3 flex items-center",children:[e.jsx(S,{className:"mr-1",size:16})," Total Tasks"]}),e.jsx("p",{className:"font-medium",children:s.data.total_tasks})]})]})]}),c&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),f&&e.jsx("div",{className:"text-red-500 text-center py-4",children:f}),((_=s==null?void 0:s.data)==null?void 0:_.projectsummary)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(w,{className:"mr-2",size:20})," Project Summary"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(N,{thead:L,tbody:z,responsive:!0,className:"min-w-full"})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(S,{className:"mr-2",size:20})," Milestone Summary"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(N,{thead:P,tbody:B,responsive:!0,className:"min-w-full"})})]})]}),!c&&!s&&e.jsx("div",{className:"text-center py-10 text-gray-500",children:!n||!d?"Please select date range to generate report":"Click 'Generate Report' to view your work summary"})]})})},pe=U(J);export{pe as default};
