import{w as G}from"./with-props-DF0D9zIo.js";import{r as a,u as Q,c as J,j as e}from"./chunk-AYJ5UCUI-nSEPIBkT.js";import{D as K}from"./DataTable-DtyPIAGZ.js";import"./CustomPagination-CBTcVvJz.js";import"./SearchInput-CMdOUuSO.js";import{t as W,a as p,B as u}from"./api-C04JdqFc.js";import{O as X,V as y}from"./index-DxoBGdjx.js";import{u as w}from"./AuthStore-BnYeBJES.js";import{u as Y}from"./use-click-outside-BhLpsQYS.js";import{M as _}from"./Modal-BCIUwH-b.js";import{L as Z}from"./log-out-DAuSHV9-.js";import{E as ee}from"./eye-2Mk8PZw-.js";import{D as te}from"./dollar-sign-D2IX7NrM.js";import"./index-knF4tUPh.js";/* empty css            */import"./react-_sXfQCJm.js";import"./index-DDa5wjlm.js";import"./iconBase-CajCgYY2.js";import"./createLucideIcon-RccWoOaL.js";const ae=()=>{Y({query:"(max-width: 768px)"});const[re,se]=a.useState(""),[ne,de]=a.useState(1),[oe,ie]=a.useState(""),[h,S]=a.useState([]),[P,f]=a.useState(!1),[le,C]=a.useState(0),[b,D]=a.useState(null),[ce,me]=a.useState(""),[xe,ge]=a.useState(8),[pe,ue]=a.useState(!1),[ye,I]=a.useState([]),[R,m]=a.useState(!1),[A,l]=a.useState(!1),[j,M]=a.useState([]),[$,F]=a.useState(""),[s,B]=a.useState(null),E=Q(),{id:q}=J(),N=decodeURIComponent(q),[d,v]=a.useState({project_code:"",invoice_no:"",request_id:"",paid_amount:"",payment_mode:"upi",notes:""}),x=w(t=>t.accessToken);w(t=>t.role);const L=[{value:"upi",label:"UPI"},{value:"bank_transfer",label:"Bank Transfer"},{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"}],k=async()=>{f(!0);try{const t=await p.get(`${u}/project/invoice/read?invoice_id=${N}`,{headers:{Authorization:`Bearer ${x}`}});if(t.data.data&&t.data.data.length>0){const r=t.data.data[0];B(r.invoice),S(r.milestone_requests),I(r.milestone_requests),C(r.milestone_requests.length)}}catch(t){console.error("Error fetching invoice details",t),D("Failed to fetch invoice details")}finally{f(!1)}},V=async t=>{var r;try{const n=await p.get(`${u}/project/pay/read?request_id=${t}`,{headers:{Authorization:`Bearer ${x}`}});M(((r=n.data)==null?void 0:r.data)||[])}catch(n){console.error("Error fetching payment history",n),y.error("Failed to fetch payment history")}},z=t=>{F(t),V(t),m(!0)},T=t=>{v({project_code:t.project_code,invoice_no:s.invoice_no,request_id:t.request_id,paid_amount:t.balance_amount,payment_mode:"upi",notes:""}),l(!0)},U=async t=>{var r,n;t.preventDefault();try{(await p.post(`${u}/project/pay/create`,d,{headers:{Authorization:`Bearer ${x}`}})).status===201&&(y.success("Payment recorded successfully!"),l(!1),k())}catch(i){console.error("Error recording payment",i),y.error(((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to record payment")}},g=t=>{const{name:r,value:n}=t.target;v(i=>({...i,[r]:n}))};a.useEffect(()=>{k()},[N]);const o=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(parseFloat(t||"0")),c=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),O=()=>[{data:"Request ID"},{data:"Milestone"},{data:"Amount"},{data:"Balance"},{data:"Status"},{data:"Due Date"},{data:"Actions"}],H=()=>h?h.map(t=>({id:t.request_id,data:[{data:t.request_id},{data:t.miles_title},{data:o(t.milestone_amount)},{data:o(t.balance_amount)},{data:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm inline-flex items-center ${t.status==="approved"?"bg-green-100 text-green-800 dark:bg-green-800/25 dark:text-green-400":t.status==="rejected"?"bg-red-100 text-red-800 dark:bg-red-800/25 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-800/25 dark:text-blue-300"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${t.status==="approved"?"bg-green-800 dark:bg-green-400":t.status==="rejected"?"bg-red-800 dark:bg-red-400":"bg-blue-800 dark:bg-blue-400"}`}),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})},{data:c(t.due_date)},{data:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>z(t.request_id),className:"p-1 text-blue-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"View Payment",children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>T(t),className:"p-1 text-red-700 rounded hover:text-gray-500 dark:hover:text-gray-300",title:"Update Payment",children:e.jsx(te,{size:18})})]}),className:"action-cell"}]})):[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:"Invoice & Payment Management"}),e.jsx("div",{children:e.jsxs("button",{className:"text-gray-500 bg-gray-200 px-3 py-1 rounded-lg mt-6",onClick:()=>E(-1),children:[e.jsx(Z,{className:"inline rotate-180 text-gray-500 mr-3"}),"Go Back"]})})]}),e.jsx(X,{position:W,reverseOrder:!1}),s&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Invoice Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Invoice No:"})," ",s.invoice_no]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",c(s.invoice_date)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Due Date:"})," ",c(s.due_date)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",s.status]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Client Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",s.client_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Company:"})," ",s.company_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Project:"})," ",s.project_title]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Financial Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Amount:"})," ",o(s.total_amount)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Paid Amount:"})," ",o(s.paid_amount)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Balance:"})," ",o(s.balance_amount)]})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Milestone Payment Requests"}),P&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),b&&e.jsx("div",{className:"text-red-500 text-center py-4",children:b}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(K,{thead:O,tbody:H,responsive:!0,className:"min-w-full"})})]})]})}),e.jsx(_,{isVisible:R,className:"w-full md:w-[800px]",onClose:()=>m(!1),title:`Payment History for ${$}`,children:e.jsxs("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:[j.length>0?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Payment ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Payment Mode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Notes"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:j.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.pay_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:o(t.paid_amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.payment_mode}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:c(t.paid_on)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-800/25 dark:text-green-400",children:t.payment_status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.notes})]},t.pay_id))})]})})}):e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"No payment history found for this request"}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>m(!1),className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",children:"Close"})})]})}),e.jsx(_,{isVisible:A,className:"w-full md:w-[600px]",onClose:()=>l(!1),title:`Record Payment for Request ${d.request_id}`,children:e.jsx("div",{className:"flex flex-col gap-6 dark:bg-gray-800 bg-white p-6 rounded-lg",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Project Code"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mt-1",children:d.project_code})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Invoice No"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mt-1",children:d.invoice_no})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Paid Amount"}),e.jsx("input",{name:"paid_amount",value:d.paid_amount,onChange:g,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",type:"number",placeholder:"Amount",required:!0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Payment Mode"}),e.jsx("select",{name:"payment_mode",value:d.payment_mode,onChange:g,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 focus:outline-none",required:!0,children:L.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/70 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Notes"}),e.jsx("textarea",{name:"notes",value:d.notes,onChange:g,className:"w-full bg-transparent text-sm font-medium text-gray-900 dark:text-gray-100 focus:outline-none min-h-[80px]",placeholder:"Payment notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"px-5 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors duration-200 font-medium text-sm",onClick:()=>l(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-md transition-colors duration-200 font-medium text-sm shadow-sm",children:"Record Payment"})]})]})})})]})},Be=G(ae);export{Be as default};
